---
title: "chapter14-3-hypocotyl"
author: "Min-Yao"
date: "2020/3/19"
output: 
  html_document: 
    keep_md: yes
---


```r
library(rethinking)
```

```
## Loading required package: rstan
```

```
## Loading required package: StanHeaders
```

```
## Loading required package: ggplot2
```

```
## rstan (Version 2.19.2, GitRev: 2e1f913d3ca3)
```

```
## For execution on a local, multicore CPU with excess RAM we recommend calling
## options(mc.cores = parallel::detectCores()).
## To avoid recompilation of unchanged Stan programs, we recommend calling
## rstan_options(auto_write = TRUE)
```

```
## For improved execution time, we recommend calling
## Sys.setenv(LOCAL_CPPFLAGS = '-march=native')
## although this causes Stan to throw an error on a few processors.
```

```
## Loading required package: parallel
```

```
## Loading required package: dagitty
```

```
## rethinking (Version 1.93)
```

```
## 
## Attaching package: 'rethinking'
```

```
## The following object is masked from 'package:stats':
## 
##     rstudent
```

```r
hyp <- read.csv("hyp.lengths.both.experiments.labels.csv")
head(hyp)
```

```
##   line length plate light exp nativename stockparent latitude longitude site
## 1 6901  2.014   1AH     H   A      Bil-7     CS22579   63.324    18.484  Bil
## 2 6901  1.477   1AH     H   A      Bil-7     CS22579   63.324    18.484  Bil
## 3 6901  1.986   1AH     H   A      Bil-7     CS22579   63.324    18.484  Bil
## 4 6901  2.744   1AH     H   A      Bil-7     CS22579   63.324    18.484  Bil
## 5 6901  1.942   1AH     H   A      Bil-7     CS22579   63.324    18.484  Bil
## 6 6901  1.935   1AH     H   A      Bil-7     CS22579   63.324    18.484  Bil
##    region country
## 1 NSweden     SWE
## 2 NSweden     SWE
## 3 NSweden     SWE
## 4 NSweden     SWE
## 5 NSweden     SWE
## 6 NSweden     SWE
```

```r
summary(hyp)
```

```
##       line            length          plate       light    exp      
##  Min.   :  5837   Min.   :0.458   38BH   :  191   H:9133   A: 7692  
##  1st Qu.:  6930   1st Qu.:3.154   17BL   :  186   L:8898   B:10339  
##  Median :  6984   Median :4.091   35BL   :  179                     
##  Mean   :  8094   Mean   :4.123   8AH    :  179                     
##  3rd Qu.:  8290   3rd Qu.:4.978   33BL   :  177                     
##  Max.   :100000   Max.   :9.914   33BH   :  176                     
##                                   (Other):16943                     
##    nativename     stockparent       latitude       longitude       
##  Ang-0  :  177   CS949  :  177   Min.   :15.11   Min.   :-123.000  
##  Ull2-3 :  175   CS22587:  175   1st Qu.:47.25   1st Qu.:   2.250  
##  Kin-0  :  170   CS22654:  170   Median :50.00   Median :  10.872  
##  Mrk-0  :  167   CS22635:  167   Mean   :49.82   Mean   :   5.614  
##  Mt-0   :  167   CS22642:  167   3rd Qu.:55.58   3rd Qu.:  16.233  
##  Est-1  :  166   (Other):13039   Max.   :63.32   Max.   : 136.310  
##  (Other):17009   NA's   : 4136   NA's   :1455    NA's   :1455      
##       site                  region        country    
##  B疇    :  357   WesternEurope :4067   SWE    :3173  
##  Pu2    :  327   SSweden       :2175   GER    :2305  
##  HR     :  322   NorthernEurope:1715   CZE    :2017  
##  G\xc3 :  309   SouthernEurope:1331   UK     :1411  
##  CIBC   :  306   Moravia       :1167   USA    :1151  
##  (Other):14955   (Other)       :4680   (Other):6519  
##  NA's   : 1455   NA's          :2896   NA's   :1455
```

```r
str(hyp)
```

```
## 'data.frame':	18031 obs. of  12 variables:
##  $ line       : int  6901 6901 6901 6901 6901 6901 6901 8357 8357 8357 ...
##  $ length     : num  2.01 1.48 1.99 2.74 1.94 ...
##  $ plate      : Factor w/ 152 levels "10AH","10AL",..: 41 41 41 41 41 41 41 41 41 41 ...
##  $ light      : Factor w/ 2 levels "H","L": 1 1 1 1 1 1 1 1 1 1 ...
##  $ exp        : Factor w/ 2 levels "A","B": 1 1 1 1 1 1 1 1 1 1 ...
##  $ nativename : Factor w/ 180 levels "\xc3-1","\xc3繹2-1",..: 24 24 24 24 24 24 24 124 124 124 ...
##  $ stockparent: Factor w/ 135 levels "CS1007","CS1065",..: 48 48 48 48 48 48 48 23 23 23 ...
##  $ latitude   : num  63.3 63.3 63.3 63.3 63.3 ...
##  $ longitude  : num  18.5 18.5 18.5 18.5 18.5 ...
##  $ site       : Factor w/ 136 levels "\xc3繹2","Ag",..: 8 8 8 8 8 8 8 93 93 93 ...
##  $ region     : Factor w/ 18 levels "(null)","CentralAsia",..: 12 12 12 12 12 12 12 16 16 16 ...
##  $ country    : Factor w/ 26 levels "AUT","BEL","CAN",..: 22 22 22 22 22 22 22 6 6 6 ...
```

### 1. without pooling_base


```r
library(dplyr)
```

```
## 
## Attaching package: 'dplyr'
```

```
## The following objects are masked from 'package:stats':
## 
##     filter, lag
```

```
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
```

```r
hyp_s <- sample_n(hyp, 10000)
summary(hyp_s)
```

```
##       line            length          plate      light    exp     
##  Min.   :  5837   Min.   :0.635   17BL   : 117   H:5052   A:4260  
##  1st Qu.:  6930   1st Qu.:3.152   8AH    : 114   L:4948   B:5740  
##  Median :  6984   Median :4.090   38BL   : 110                    
##  Mean   :  8118   Mean   :4.127   38BH   : 108                    
##  3rd Qu.:  8290   3rd Qu.:4.978   35BL   : 104                    
##  Max.   :100000   Max.   :9.914   15BH   : 103                    
##                                   (Other):9344                    
##      nativename    stockparent      latitude       longitude       
##  Kin-0    : 107   CS22654: 107   Min.   :15.11   Min.   :-123.000  
##  Ull2-3   : 102   CS22587: 102   1st Qu.:47.25   1st Qu.:   2.250  
##  Van-0    : 102   CS22627: 102   Median :50.00   Median :  10.500  
##  Ang-0    :  97   CS1494 :  97   Mean   :49.90   Mean   :   5.252  
##  Rsch-4   :  97   CS6187 :  97   3rd Qu.:55.58   3rd Qu.:  16.200  
##  Seattle-0:  97   (Other):7241   Max.   :63.32   Max.   : 136.310  
##  (Other)  :9398   NA's   :2254   NA's   :770     NA's   :770       
##       site                 region        country    
##  B疇    : 199   WesternEurope :2293   SWE    :1788  
##  HR     : 185   SSweden       :1209   GER    :1301  
##  Pu2    : 170   NorthernEurope: 966   CZE    :1102  
##  G\xc3 : 169   SouthernEurope: 717   UK     : 776  
##  CIBC   : 164   Moravia       : 644   USA    : 638  
##  (Other):8343   (Other)       :2606   (Other):3625  
##  NA's   : 770   NA's          :1565   NA's   : 770
```

```r
str(hyp_s)
```

```
## 'data.frame':	10000 obs. of  12 variables:
##  $ line       : int  8334 8424 7520 7520 6900 6926 6910 8426 6922 8297 ...
##  $ length     : num  5.25 6.34 2.48 3.29 4.72 ...
##  $ plate      : Factor w/ 152 levels "10AH","10AL",..: 84 43 55 94 54 64 74 122 109 120 ...
##  $ light      : Factor w/ 2 levels "H","L": 2 1 1 2 2 2 2 2 1 2 ...
##  $ exp        : Factor w/ 2 levels "A","B": 2 2 2 1 1 2 1 1 1 2 ...
##  $ nativename : Factor w/ 180 levels "\xc3-1","\xc3繹2-1",..: 103 81 101 101 23 84 43 164 67 63 ...
##  $ stockparent: Factor w/ 135 levels "CS1007","CS1065",..: 17 129 62 62 47 119 104 NA 85 6 ...
##  $ latitude   : num  55.7 35 49.4 49.4 63.3 ...
##  $ longitude  : num  13.2 77 16.8 16.8 18.5 ...
##  $ site       : Factor w/ 136 levels "\xc3繹2","Ag",..: 74 56 73 73 8 59 23 123 43 41 ...
##  $ region     : Factor w/ 18 levels "(null)","CentralAsia",..: 17 15 9 9 12 8 16 17 18 18 ...
##  $ country    : Factor w/ 26 levels "AUT","BEL","CAN",..: 22 10 5 5 22 26 12 22 9 21 ...
```

```r
dat_list1 <- list(
  length = scale(hyp_s$length),
  line = as.integer(as.factor(hyp_s$line)),
  light = as.integer(hyp_s$light=="H")
)


modle_base <- ulam(
  alist(
    length ~ dnorm(mu, sigma),
    mu <- a[line] + bI[line]*light,
    a[line] ~ dnorm(0, 1),
    bI[line] ~ dnorm(0, 1),
    sigma ~ dexp(1)
  ), data=dat_list1 , chains=4 , cores=4 , log_lik=TRUE)

precis( modle_base, depth=2 , pars=c("bI","sigma"))
```

```
##                  mean          sd        5.5%        94.5%    n_eff      Rhat
## bI[1]   -0.4767634835 0.168444973 -0.74080030 -0.205384386 3091.225 0.9987261
## bI[2]   -0.8803512417 0.144695684 -1.11711914 -0.652202753 3251.518 0.9996017
## bI[3]   -1.7926845319 0.257091081 -2.20347003 -1.402059233 2873.019 0.9990647
## bI[4]   -0.6726215104 0.157097793 -0.92443437 -0.414055321 3578.012 1.0001289
## bI[5]   -0.5897965935 0.170249959 -0.85271501 -0.316410942 3324.962 0.9982098
## bI[6]   -0.2293078796 0.132339438 -0.43456260 -0.020799904 3283.513 0.9994189
## bI[7]   -0.9991703782 0.187868286 -1.30167046 -0.701502248 3318.113 0.9984822
## bI[8]   -0.9342193960 0.246685516 -1.32283134 -0.542363943 3537.810 0.9988340
## bI[9]   -1.0518912364 0.542267690 -1.92479772 -0.190312178 2740.756 0.9994990
## bI[10]  -0.5314311978 0.556244822 -1.41651033  0.353664472 2484.770 0.9990603
## bI[11]  -0.8370425382 0.158021047 -1.08673272 -0.584326527 3983.407 0.9992527
## bI[12]  -0.5492237827 0.186254415 -0.83886611 -0.248323420 3369.941 0.9985197
## bI[13]  -0.9013424749 0.137714953 -1.12310262 -0.679080993 3357.285 0.9997996
## bI[14]  -0.6787873221 0.180077010 -0.96799981 -0.393498112 3402.107 1.0000373
## bI[15]  -0.4876382476 0.193581002 -0.78954739 -0.182603119 3494.500 0.9988059
## bI[16]  -0.9231590442 0.152582860 -1.16694067 -0.682999750 3568.271 0.9998939
## bI[17]  -1.1990279770 0.172527681 -1.48598034 -0.924788546 3344.919 0.9990870
## bI[18]  -1.2669753604 0.268830097 -1.70743485 -0.844795961 2949.207 0.9984682
## bI[19]  -0.7069706764 0.183904960 -0.99974437 -0.417214919 3541.325 0.9991839
## bI[20]  -0.8168041708 0.129741111 -1.02873308 -0.611637144 3285.444 0.9998814
## bI[21]  -1.2508629722 0.143126055 -1.47789758 -1.015900228 5164.879 0.9985611
## bI[22]  -1.4055265544 0.135062946 -1.62584102 -1.193303577 3580.331 0.9991520
## bI[23]  -1.2234071948 0.144034871 -1.45677501 -0.993519496 4488.124 0.9991452
## bI[24]  -0.4741191546 0.165410474 -0.73307588 -0.216809807 3026.475 0.9983563
## bI[25]  -0.8450205833 0.143852897 -1.07532552 -0.617544457 3450.086 0.9982630
## bI[26]  -0.8936185631 0.369653779 -1.46086490 -0.300624928 3328.014 0.9992882
## bI[27]  -1.0591687762 0.160120973 -1.30966360 -0.806479473 4359.553 0.9988805
## bI[28]  -1.6954276899 0.143241871 -1.92853086 -1.469441124 3919.543 0.9986170
## bI[29]  -1.1604100098 0.215831140 -1.50108591 -0.818645166 4141.878 0.9990498
## bI[30]  -0.0737073619 0.127967211 -0.27644460  0.124114737 3138.646 1.0005314
## bI[31]  -1.4159978284 0.159311113 -1.67023681 -1.148035571 3076.535 0.9983475
## bI[32]  -1.1796953550 0.480241015 -1.95721270 -0.398404878 2633.618 0.9996242
## bI[33]  -1.1899858008 0.161222792 -1.45661133 -0.932259304 3249.678 1.0004860
## bI[34]  -0.4869518245 0.133319470 -0.70426721 -0.278562604 2501.931 1.0007596
## bI[35]  -0.8473866637 0.138968573 -1.07221931 -0.628445750 2878.010 1.0004977
## bI[36]  -0.7770517413 0.142952550 -1.00568484 -0.544329309 3253.796 0.9988108
## bI[37]  -0.8234988075 0.134351603 -1.03511660 -0.610629360 4313.573 0.9985807
## bI[38]  -1.0478913235 0.130895389 -1.25805749 -0.832975758 3822.255 0.9985241
## bI[39]  -0.8927102778 0.119990333 -1.08794037 -0.699880666 3042.477 0.9991500
## bI[40]   0.0246726413 0.771667556 -1.18315441  1.262263129 3210.393 1.0001330
## bI[41]   0.4496906002 0.145924693  0.21575846  0.688817468 2675.941 0.9992562
## bI[42]  -1.6354225223 0.134046577 -1.84586065 -1.429420806 2859.781 1.0004083
## bI[43]  -0.4754416675 0.177031307 -0.75980209 -0.195408811 2863.237 1.0001660
## bI[44]  -0.9966937671 0.252729804 -1.40943871 -0.588788292 3095.380 0.9989058
## bI[45]  -0.2695231394 0.246707686 -0.66394555  0.139117412 4862.870 0.9989756
## bI[46]  -0.3689882215 0.167381682 -0.63619254 -0.104731167 3133.600 0.9991638
## bI[47]  -0.4107841284 0.160052883 -0.66681386 -0.156519252 3415.435 0.9988404
## bI[48]  -0.8603522298 0.134834241 -1.07612294 -0.651646357 2990.354 0.9985581
## bI[49]  -0.6206809353 0.170979501 -0.90249485 -0.338348234 3918.625 0.9994816
## bI[50]  -0.3035678307 0.139577481 -0.53051239 -0.086070402 3284.270 0.9993171
## bI[51]  -0.5465946874 0.126387090 -0.75157738 -0.340125927 3249.619 0.9994873
## bI[52]  -0.5469032454 0.160647319 -0.79893806 -0.294103352 3339.784 0.9989410
## bI[53]  -0.0134027569 0.175687530 -0.28781961  0.269086302 2916.949 0.9998400
## bI[54]  -1.1022227161 0.157501070 -1.34953481 -0.851461512 2796.896 0.9998549
## bI[55]   0.0719175683 0.233084917 -0.29623126  0.458269263 4135.917 0.9998353
## bI[56]  -1.2205328173 0.133367813 -1.43590268 -1.007432127 3064.767 1.0001308
## bI[57]  -0.6679191280 0.199786733 -0.98983002 -0.348574555 3128.921 0.9985121
## bI[58]  -0.7601321895 0.163326822 -1.02298311 -0.498035872 2890.761 0.9998512
## bI[59]  -0.9780807630 0.155937604 -1.22414046 -0.729324641 3601.773 0.9994505
## bI[60]  -0.3065773821 0.123070261 -0.50361160 -0.117200679 3107.835 0.9996587
## bI[61]  -1.5429242485 0.165499764 -1.80651183 -1.278270737 2868.986 1.0010326
## bI[62]  -0.7186306733 0.137417759 -0.94004764 -0.500644365 3820.608 0.9983804
## bI[63]  -0.4139733500 0.161323252 -0.67911785 -0.149241503 3959.575 0.9992991
## bI[64]  -1.0496445902 0.149239843 -1.29026002 -0.814896129 3414.738 0.9992899
## bI[65]  -0.6677807453 0.176517897 -0.94986463 -0.378334063 3543.022 0.9988168
## bI[66]  -1.1470190726 0.142871066 -1.37014935 -0.913443826 3937.160 0.9994215
## bI[67]  -0.9144092683 0.350825784 -1.46653860 -0.348714720 3202.276 0.9993983
## bI[68]  -0.2242237487 0.135668011 -0.44394316 -0.006529658 4661.933 0.9988187
## bI[69]  -0.7356024804 0.146897654 -0.97470545 -0.505914750 3182.758 1.0003135
## bI[70]  -1.6621784417 0.202288374 -1.98122801 -1.329669600 4313.684 0.9995967
## bI[71]  -0.7509363876 0.200411917 -1.07207292 -0.438873379 2463.542 0.9989246
## bI[72]  -0.1865151624 0.133354866 -0.40042347  0.022376634 3699.328 1.0004631
## bI[73]  -0.6098738779 0.790326491 -1.90175734  0.617008906 2989.980 0.9984410
## bI[74]  -0.5895321373 0.152055226 -0.83668740 -0.350326611 2942.916 0.9990506
## bI[75]  -0.4153364366 0.126091397 -0.61974719 -0.214218403 3798.875 0.9993450
## bI[76]  -0.4313471973 0.141913358 -0.65752313 -0.210888848 2852.080 1.0006035
## bI[77]  -0.7437575547 0.185358638 -1.04119666 -0.440414845 3790.363 0.9985351
## bI[78]  -0.1279095323 0.124952172 -0.32645833  0.060575777 2921.537 0.9998108
## bI[79]  -0.2629535600 0.146500910 -0.49469547 -0.014729112 5030.835 0.9988621
## bI[80]  -0.2417365310 0.187019909 -0.54584771  0.059951269 3236.895 1.0001350
## bI[81]   0.0119421947 0.949980838 -1.48644388  1.548395394 2853.142 1.0003298
## bI[82]  -0.6012373890 0.144041908 -0.83014232 -0.370146269 3107.820 0.9982600
## bI[83]  -0.8728792887 0.144170800 -1.09307814 -0.641166815 2856.837 0.9987885
## bI[84]  -0.0071210218 0.984460121 -1.54906985  1.528579985 3265.528 0.9984625
## bI[85]  -0.3657888249 0.166368765 -0.62750718 -0.088623642 3527.851 0.9985968
## bI[86]  -0.6162041146 0.258356804 -1.02498194 -0.196837478 3762.873 0.9988121
## bI[87]  -1.0772506803 0.226646522 -1.44246697 -0.711103715 3123.978 0.9991300
## bI[88]  -0.1420013709 0.130803306 -0.34974009  0.064004647 2935.780 0.9986990
## bI[89]  -1.4601939043 0.466302948 -2.24569497 -0.721252323 2901.546 0.9985518
## bI[90]  -0.0312243110 0.182649943 -0.32372784  0.275601149 3246.530 0.9998948
## bI[91]  -0.3310188683 0.218495136 -0.67833224  0.015366389 3442.455 0.9997041
## bI[92]  -0.5702642403 0.149343363 -0.80947795 -0.335391638 3860.969 0.9982602
## bI[93]   0.6987052809 0.323578774  0.17498624  1.212024648 3963.390 0.9991411
## bI[94]  -0.3560699868 0.198843371 -0.67301924 -0.036871522 2643.518 1.0002934
## bI[95]  -0.4420305562 0.200057468 -0.76477752 -0.138036196 3059.819 1.0002791
## bI[96]  -1.1111346477 0.500448343 -1.95167825 -0.334097446 2871.986 0.9986897
## bI[97]  -0.7765006818 0.252271007 -1.17928484 -0.368716019 2873.469 0.9994233
## bI[98]  -1.2880845937 0.130162881 -1.49435114 -1.075935664 3612.139 0.9991461
## bI[99]  -1.4941151982 0.163141711 -1.75233406 -1.231495731 3263.442 0.9988991
## bI[100] -0.5638773031 0.143787688 -0.78815695 -0.341008735 4052.285 0.9991608
## bI[101] -0.9251912785 0.169637150 -1.19951951 -0.657392009 2944.790 0.9994025
## bI[102] -1.1259416105 0.195438844 -1.43768287 -0.818692991 3601.261 0.9982134
## bI[103] -0.3781518971 0.727694555 -1.55303407  0.796131640 3746.854 0.9986739
## bI[104] -0.9358236541 0.178815680 -1.21677685 -0.650357359 3570.146 0.9993149
## bI[105] -0.0005347825 0.178419993 -0.27849322  0.285654978 3599.521 0.9989512
## bI[106] -1.0402272501 0.160363737 -1.29293954 -0.789775823 2884.320 0.9995774
## bI[107] -1.2675704823 0.443561301 -1.99756731 -0.568225915 3513.803 1.0004084
## bI[108] -0.2956808898 0.256037918 -0.70945977  0.123444867 3007.829 1.0018130
## bI[109] -1.2708493219 0.495985884 -2.05658608 -0.491384065 4234.834 0.9982057
## bI[110] -0.0846598095 0.193304894 -0.39495828  0.225366535 2586.641 0.9985980
## bI[111] -0.8050937402 0.262555351 -1.21674851 -0.368908079 3365.586 0.9981444
## bI[112] -0.6258696301 0.161668400 -0.88230406 -0.362761809 3790.702 0.9993364
## bI[113] -0.9275030906 0.151483079 -1.16643698 -0.684378315 2861.970 0.9989799
## bI[114] -0.1167363057 0.175861248 -0.39555550  0.163864371 3182.402 0.9983247
## bI[115] -1.3188133253 0.163950289 -1.58346045 -1.055381642 4774.907 0.9989790
## bI[116] -1.7835679552 0.250346164 -2.17954368 -1.378915616 3527.134 0.9993084
## bI[117] -0.3963572236 0.140085591 -0.62199929 -0.181560943 3214.824 0.9990862
## bI[118] -1.0579332352 0.127685214 -1.26310302 -0.853943749 3071.706 0.9987293
## bI[119] -0.9589887638 0.472252860 -1.70532762 -0.217047266 3830.422 0.9992558
## bI[120] -0.5406721755 0.709126152 -1.68257076  0.600867648 3649.538 0.9997961
## bI[121] -0.3219096370 0.143192597 -0.55378730 -0.090122908 3680.550 1.0004352
## bI[122] -0.6800937407 0.162159233 -0.94049202 -0.412939298 3626.136 0.9982675
## bI[123] -0.4122749637 0.133669476 -0.62860588 -0.199801222 3682.231 0.9996970
## bI[124] -1.0650143193 0.138534972 -1.27870109 -0.843830367 2633.686 0.9998644
## bI[125] -0.8962592452 0.305641753 -1.38082091 -0.406965534 3182.688 0.9983952
## bI[126] -1.2445180922 0.164625708 -1.51053768 -0.985549018 2524.634 0.9988839
## bI[127] -1.1801611599 0.173518599 -1.46194124 -0.899823581 3370.742 0.9994980
## bI[128] -0.2355632378 0.148778962 -0.47655154  0.002948519 2718.529 0.9984438
## bI[129] -1.0706914074 0.162677261 -1.33002384 -0.814546110 3577.120 0.9984273
## bI[130] -0.9554981186 0.204453314 -1.29155431 -0.631374760 3235.152 0.9984439
## bI[131] -0.6116656451 0.135956380 -0.82497045 -0.394432755 2992.993 0.9985631
## bI[132] -1.0290693254 0.143239686 -1.26311126 -0.798865974 3532.046 0.9989741
## bI[133]  0.0147307101 0.977767038 -1.48325832  1.601680986 2761.856 0.9986094
## bI[134] -0.6645562043 0.323949759 -1.17883736 -0.165490861 3281.741 0.9985887
## bI[135] -0.6628536424 0.516899241 -1.48642059  0.149776999 3566.194 0.9996730
## bI[136] -1.1095356635 0.125646053 -1.30689705 -0.909270111 3200.460 1.0006969
## bI[137] -0.8589813969 0.157807809 -1.10399380 -0.607007157 2888.139 0.9989911
## bI[138] -0.7964458167 0.141299804 -1.02435968 -0.577276519 2705.680 0.9995350
## bI[139] -1.0592952167 0.137559850 -1.27628125 -0.839198910 4050.968 0.9990584
## bI[140] -0.5976719762 0.291793222 -1.06918827 -0.134791193 2958.354 0.9986668
## bI[141] -0.1395448702 0.136372665 -0.36407353  0.071654634 3449.623 0.9991832
## bI[142] -0.1498121824 0.177861804 -0.43212009  0.132480544 2960.993 0.9988481
## bI[143]  0.2874616113 0.152060425  0.04549202  0.529324699 3311.733 0.9993172
## bI[144] -0.4018217778 0.154150603 -0.64345039 -0.148145145 3849.640 0.9996875
## bI[145] -0.6365181246 0.184825676 -0.92952259 -0.337922620 2677.839 0.9996084
## bI[146] -0.4496702288 0.145232272 -0.68060778 -0.216230970 3743.221 0.9985340
## bI[147] -1.0519928497 0.155659017 -1.29851806 -0.799321217 3031.632 0.9999718
## bI[148] -1.3313926120 0.141718154 -1.55330750 -1.112096673 3231.866 0.9993528
## bI[149] -0.9157509121 0.165846200 -1.19280923 -0.654605734 3554.621 0.9990324
## bI[150] -0.4820096475 0.536030195 -1.35722497  0.343636872 3392.368 0.9984729
## bI[151] -1.3620192117 0.180194065 -1.65032149 -1.074092205 2849.632 0.9992656
## bI[152] -1.1955730963 0.165473915 -1.46333593 -0.933895464 3084.084 0.9982925
## bI[153] -0.8925523015 0.167248842 -1.14940270 -0.622028251 3087.581 0.9988755
## bI[154] -1.1423177121 0.156121541 -1.39542676 -0.895747395 2711.330 0.9997756
## bI[155]  0.1481949482 0.239679219 -0.24899795  0.535260248 3537.916 0.9990468
## bI[156] -0.5828547629 0.149676651 -0.82774685 -0.350431162 3464.944 0.9993750
## bI[157] -0.4591617611 0.763736699 -1.67025180  0.734776383 3880.838 0.9987362
## bI[158]  0.0628450180 0.179384959 -0.23024924  0.345323137 4116.307 0.9986251
## bI[159] -0.7831377301 0.185075039 -1.07811153 -0.485621596 3988.289 0.9985226
## bI[160] -1.1477343659 0.159380638 -1.40611386 -0.895332015 3582.288 0.9997263
## bI[161] -0.4773226597 0.145707077 -0.71295667 -0.244262987 3295.375 0.9997077
## bI[162] -0.5025369356 0.141732246 -0.73192270 -0.274351667 2453.783 0.9997232
## bI[163] -0.3743117716 0.174256481 -0.65238543 -0.100359298 3190.528 0.9989468
## bI[164] -0.6341664140 0.183443223 -0.92832332 -0.341067878 3413.747 0.9993057
## bI[165] -0.6691158969 0.125010633 -0.87196418 -0.470636814 2876.975 1.0008498
## bI[166] -0.4047992940 0.177521993 -0.69646866 -0.120277781 2937.656 0.9999136
## bI[167] -0.7196153932 0.177677269 -0.99604378 -0.428683780 3042.301 0.9992015
## bI[168] -0.8142063150 0.159855314 -1.06718649 -0.562049402 3391.527 0.9986501
## bI[169] -0.8292379042 0.150888327 -1.07335365 -0.592356413 3610.947 0.9990013
## bI[170] -1.1365345317 0.156925997 -1.39075366 -0.889820814 3107.723 0.9993590
## bI[171] -0.7401383175 0.135035086 -0.96209991 -0.526505969 3329.087 0.9995105
## bI[172] -0.0030997331 0.145268159 -0.23573624  0.225455204 3300.171 0.9985812
## bI[173] -1.1091415155 0.138902494 -1.33034365 -0.882916653 3554.446 0.9988250
## bI[174] -0.7989156152 0.788448783 -2.05779835  0.471021249 3153.379 1.0007270
## bI[175] -1.0513613805 0.145375573 -1.28690135 -0.816486966 3737.384 0.9987187
## bI[176] -0.9289215914 0.152303516 -1.17368854 -0.685092056 3729.279 0.9996276
## bI[177] -1.2762284477 0.137274660 -1.48887088 -1.055512785 3363.041 0.9993125
## bI[178] -1.8057090055 0.124875986 -2.01166169 -1.608707474 3287.193 0.9987101
## bI[179] -1.3393011515 0.151710700 -1.58383415 -1.102756171 3090.643 0.9990775
## sigma    0.6344487353 0.004422105  0.62753365  0.641633824 1881.500 1.0014202
```

```r
plot( precis(modle_base) )
```

```
## 358 vector or matrix parameters hidden. Use depth=2 to show them.
```

![](chpater14-3-hypocotyl_files/figure-html/unnamed-chunk-2-1.png)<!-- -->


```r
library(tidyverse)
```

```
## -- Attaching packages ---------------------------------------------------------------- tidyverse 1.3.0 --
```

```
## √ tibble  2.1.3     √ purrr   0.3.3
## √ tidyr   1.0.0     √ stringr 1.4.0
## √ readr   1.3.1     √ forcats 0.4.0
```

```
## -- Conflicts ------------------------------------------------------------------- tidyverse_conflicts() --
## x tidyr::extract() masks rstan::extract()
## x dplyr::filter()  masks stats::filter()
## x dplyr::lag()     masks stats::lag()
## x purrr::map()     masks rethinking::map()
```

```r
hyp_s_new <- hyp_s %>% unite("plate_exp", c("plate", "exp"), remove = FALSE)
#head(hyp_s_new)
str(hyp_s_new)
```

```
## 'data.frame':	10000 obs. of  13 variables:
##  $ line       : int  8334 8424 7520 7520 6900 6926 6910 8426 6922 8297 ...
##  $ length     : num  5.25 6.34 2.48 3.29 4.72 ...
##  $ plate_exp  : chr  "29BL_B" "1BH_B" "22BH_B" "31AL_A" ...
##  $ plate      : Factor w/ 152 levels "10AH","10AL",..: 84 43 55 94 54 64 74 122 109 120 ...
##  $ light      : Factor w/ 2 levels "H","L": 2 1 1 2 2 2 2 2 1 2 ...
##  $ exp        : Factor w/ 2 levels "A","B": 2 2 2 1 1 2 1 1 1 2 ...
##  $ nativename : Factor w/ 180 levels "\xc3-1","\xc3繹2-1",..: 103 81 101 101 23 84 43 164 67 63 ...
##  $ stockparent: Factor w/ 135 levels "CS1007","CS1065",..: 17 129 62 62 47 119 104 NA 85 6 ...
##  $ latitude   : num  55.7 35 49.4 49.4 63.3 ...
##  $ longitude  : num  13.2 77 16.8 16.8 18.5 ...
##  $ site       : Factor w/ 136 levels "\xc3繹2","Ag",..: 74 56 73 73 8 59 23 123 43 41 ...
##  $ region     : Factor w/ 18 levels "(null)","CentralAsia",..: 17 15 9 9 12 8 16 17 18 18 ...
##  $ country    : Factor w/ 26 levels "AUT","BEL","CAN",..: 22 10 5 5 22 26 12 22 9 21 ...
```

```r
dat_list <- list(
  length = scale(hyp_s_new$length),
  line = as.integer(as.factor(hyp_s_new$line)),
  light = as.integer(hyp_s_new$light=="H"),
  plate_exp = as.integer(as.factor(hyp_s_new$plate_exp))
)

#head(dat_list)
summary(dat_list)
```

```
##           Length Class  Mode   
## length    10000  -none- numeric
## line      10000  -none- numeric
## light     10000  -none- numeric
## plate_exp 10000  -none- numeric
```

```r
str(dat_list)
```

```
## List of 4
##  $ length   : num [1:10000, 1] 0.818 1.617 -1.209 -0.615 0.437 ...
##   ..- attr(*, "scaled:center")= num 4.13
##   ..- attr(*, "scaled:scale")= num 1.37
##  $ line     : int [1:10000] 154 176 98 98 17 39 25 177 36 140 ...
##  $ light    : int [1:10000] 0 1 1 0 0 0 0 0 1 0 ...
##  $ plate_exp: int [1:10000] 84 43 55 94 54 64 74 122 109 120 ...
```

### 1.without pooling_fixed


```r
modle_fixed <- ulam(
  alist(
    length ~ dnorm(mu, sigma),
    mu <- a[line] + bI[line]*light + bP[plate_exp],
    a[line] ~ dnorm(0, 1),
    bI[line] ~ dnorm(0, 1),
    bP[plate_exp] ~ dnorm(0, 1),
    sigma ~ dexp(1)
  ), data=dat_list , chains=4 , cores=4 , log_lik=TRUE)
```

```
## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
## Running the chains for more iterations may help. See
## http://mc-stan.org/misc/warnings.html#bulk-ess
```

```
## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
## Running the chains for more iterations may help. See
## http://mc-stan.org/misc/warnings.html#tail-ess
```

```r
precis( modle_fixed, depth=2 , pars=c("bI","sigma"))
```

```
##                 mean          sd         5.5%         94.5%     n_eff      Rhat
## bI[1]    0.135451621 0.185750621 -0.169391670  0.4230424054  705.5976 1.0100352
## bI[2]   -0.340790999 0.166682762 -0.610003063 -0.0729544978  828.1353 1.0067527
## bI[3]   -0.950905993 0.271258599 -1.384367852 -0.5320962951 1954.8146 1.0019068
## bI[4]   -0.198449661 0.171974179 -0.468767642  0.0751174510  849.5539 1.0065215
## bI[5]    0.048928598 0.181242306 -0.243875982  0.3337334081  858.9132 1.0073646
## bI[6]    0.338091768 0.159586128  0.082923502  0.5935118978  607.8376 1.0081078
## bI[7]   -0.170629677 0.193098333 -0.471699357  0.1391114643  947.9664 1.0076964
## bI[8]   -0.401384794 0.252432271 -0.822139087 -0.0031871795 2074.8871 1.0022724
## bI[9]   -0.564083630 0.526321132 -1.383578102  0.2806677698 3760.2642 1.0005081
## bI[10]  -0.377258485 0.541663836 -1.241264961  0.5000702091 3691.4806 0.9993262
## bI[11]  -0.507573584 0.168882470 -0.780429943 -0.2417925802  577.0366 1.0092529
## bI[12]  -0.054970294 0.187768387 -0.353470533  0.2422180419 1005.6794 1.0077600
## bI[13]  -0.274793314 0.155397158 -0.529634134 -0.0308088329  822.0949 1.0070692
## bI[14]  -0.069395662 0.189244124 -0.360236166  0.2155275646  945.5644 1.0062426
## bI[15]  -0.072755916 0.203728132 -0.403008557  0.2605255309 1276.4409 1.0027146
## bI[16]  -0.302175412 0.160849164 -0.561713527 -0.0502529570  926.9120 1.0064840
## bI[17]  -0.347901612 0.184998704 -0.641777727 -0.0530216110  964.4301 1.0062256
## bI[18]  -0.483889819 0.267638953 -0.903105074 -0.0673442470 2033.8893 1.0002627
## bI[19]  -0.116527932 0.196319448 -0.432218349  0.2001187452 1054.6195 1.0065273
## bI[20]  -0.235995849 0.148706042 -0.472224849 -0.0004548214  753.6462 1.0085113
## bI[21]  -0.274349513 0.159684772 -0.530695919 -0.0239634120  711.5189 1.0124351
## bI[22]  -0.778208336 0.149046949 -1.022205586 -0.5451638618  663.7070 1.0077150
## bI[23]  -0.635484088 0.158670054 -0.893264516 -0.3777138443  619.6328 1.0091359
## bI[24]   0.531460163 0.174026678  0.255191866  0.8134825602  708.3659 1.0075212
## bI[25]   0.022124679 0.162196187 -0.235938741  0.2760913457  665.2774 1.0103923
## bI[26]  -0.302750422 0.360618142 -0.882913152  0.2845522065 2497.4262 1.0007574
## bI[27]  -0.335766783 0.174868213 -0.615025712 -0.0633456026 1033.0269 1.0052378
## bI[28]  -0.934505375 0.157850112 -1.191207566 -0.6814913660  820.0785 1.0069239
## bI[29]  -0.315291852 0.213904455 -0.661354507  0.0198184898 1092.9354 1.0041054
## bI[30]   0.355626214 0.142610423  0.124547575  0.5775614797  573.5431 1.0093529
## bI[31]  -0.900637888 0.175711483 -1.172087165 -0.6115931742  893.0618 1.0063912
## bI[32]  -0.817246196 0.442704247 -1.520643243 -0.1162071116 2933.6879 1.0006961
## bI[33]  -0.653009900 0.179136336 -0.942616574 -0.3735672222  630.4146 1.0097237
## bI[34]   0.193588546 0.148261056 -0.044031746  0.4334952299  627.8734 1.0094737
## bI[35]   0.234127020 0.163873547 -0.030126467  0.5044888724  745.5476 1.0086947
## bI[36]  -0.137080365 0.150741740 -0.380916818  0.0986005987  665.0556 1.0081708
## bI[37]  -0.065154053 0.151536175 -0.311324193  0.1782853805  716.4836 1.0050873
## bI[38]  -0.375211506 0.153141653 -0.619356490 -0.1348438262  470.0484 1.0118124
## bI[39]  -0.286491556 0.147961554 -0.520503429 -0.0504400152  747.5337 1.0080357
## bI[40]   0.295158316 0.743453195 -0.874826438  1.5004993240 3935.9789 0.9985330
## bI[41]   1.133840946 0.170962024  0.854948205  1.3910267186  911.8337 1.0048116
## bI[42]  -1.021337723 0.149739317 -1.267512998 -0.7820839773  780.6480 1.0077291
## bI[43]   0.050202116 0.178013152 -0.231977753  0.3257174805  915.7265 1.0028290
## bI[44]  -0.511497111 0.238243321 -0.895112375 -0.1356811397 1436.2728 1.0040508
## bI[45]   0.132242494 0.240341966 -0.241915166  0.5170302885 1438.3789 1.0042829
## bI[46]   0.142010003 0.185188958 -0.146444805  0.4493146759 1138.4151 1.0052774
## bI[47]   0.170804389 0.171986211 -0.097664646  0.4432381086  884.9244 1.0079580
## bI[48]  -0.150338279 0.157278401 -0.406476157  0.0996036321  698.1289 1.0100200
## bI[49]   0.068156763 0.186057172 -0.237960532  0.3701882894  914.1331 1.0073691
## bI[50]   0.279334010 0.149098265  0.041798370  0.5089214573  606.5865 1.0127915
## bI[51]   0.164126338 0.155535679 -0.083225285  0.4092329796  803.7928 1.0051299
## bI[52]   0.034970270 0.166679844 -0.232709394  0.3098902376  730.0846 1.0088324
## bI[53]   0.445521803 0.182010124  0.147652329  0.7403424505 1051.4166 1.0062667
## bI[54]  -0.297611638 0.166326081 -0.564249435 -0.0320069287  728.6166 1.0069707
## bI[55]   0.135019801 0.246539521 -0.255766820  0.5286350692 1527.5305 1.0038865
## bI[56]  -0.539276519 0.153240017 -0.789218242 -0.3057789791  539.6656 1.0120456
## bI[57]  -0.180065282 0.195035516 -0.503004077  0.1248282222 1061.6624 1.0056408
## bI[58]   0.002512866 0.172647145 -0.273347619  0.2844410012  754.5112 1.0060935
## bI[59]  -0.360887939 0.155814301 -0.615696171 -0.1172102250  554.9280 1.0107182
## bI[60]   0.240788095 0.144024925  0.015723438  0.4721137085  729.6999 1.0098716
## bI[61]  -0.723543298 0.170898523 -0.984300101 -0.4505853688  799.7793 1.0064302
## bI[62]   0.145749516 0.151622068 -0.092370140  0.3833395151  667.7747 1.0098784
## bI[63]   0.077718888 0.183642821 -0.213304527  0.3691122740  790.5300 1.0115745
## bI[64]  -0.454766031 0.161444275 -0.709853707 -0.1832878003  583.9649 1.0107473
## bI[65]  -0.288052049 0.180201242 -0.575721250 -0.0031537280  932.1444 1.0042632
## bI[66]  -0.287834039 0.161570316 -0.545106762 -0.0284732057  827.9747 1.0067636
## bI[67]  -0.587051066 0.343880149 -1.134548789 -0.0337937929 2554.6347 0.9991082
## bI[68]   0.445137430 0.149304897  0.212235411  0.6807834678  631.6153 1.0082932
## bI[69]  -0.162232791 0.172556258 -0.435063807  0.1165802153  694.2744 1.0074401
## bI[70]  -1.018231807 0.206097081 -1.344658386 -0.6780016117 1022.0279 1.0038315
## bI[71]  -0.375828210 0.198660298 -0.686657048 -0.0584139461 1052.1645 1.0080738
## bI[72]   0.495205765 0.155257118  0.247111170  0.7426831335  650.0814 1.0106699
## bI[73]  -0.163528779 0.780505567 -1.416955951  1.0962611327 4607.9870 0.9986361
## bI[74]   0.212270836 0.161143406 -0.043959310  0.4674957516  890.4967 1.0083987
## bI[75]   0.473672273 0.149293441  0.236929849  0.7023151864  668.8968 1.0075125
## bI[76]   0.325281412 0.168788637  0.048468911  0.5901532432  781.0625 1.0117361
## bI[77]  -0.123519876 0.185785648 -0.418336446  0.1825947958  882.6666 1.0073342
## bI[78]   0.443192233 0.146699919  0.207247228  0.6788039034  585.6603 1.0114716
## bI[79]   0.369669989 0.157517557  0.116166149  0.6240122629  573.4577 1.0098639
## bI[80]   0.171521591 0.200281097 -0.143671648  0.4923177148 1045.9170 1.0050831
## bI[81]   0.002159214 1.046243863 -1.715165821  1.7245268127 4689.0250 0.9992266
## bI[82]  -0.159989192 0.157258379 -0.402234656  0.0869554252  653.7985 1.0093901
## bI[83]  -0.175904712 0.158632369 -0.428152642  0.0679541072  869.8473 1.0085708
## bI[84]   0.002083205 1.018972104 -1.652878065  1.6229220983 5656.0111 0.9990456
## bI[85]   0.224168484 0.172446673 -0.049448161  0.5053448699  370.5997 1.0154334
## bI[86]  -0.010543692 0.250866763 -0.417672591  0.3872883596 1625.6603 1.0017412
## bI[87]  -0.795441910 0.219847187 -1.162072807 -0.4554769533 1083.5181 1.0063863
## bI[88]   0.236474529 0.156299915 -0.013488485  0.4931414436  808.3602 1.0108943
## bI[89]  -0.979604616 0.440121337 -1.682980934 -0.3042186707 3285.8801 0.9992116
## bI[90]   0.526017813 0.191859761  0.212083781  0.8238963865 1072.7626 1.0055183
## bI[91]   0.396100324 0.213316803  0.049794425  0.7322442116 1276.9607 1.0029102
## bI[92]  -0.185828558 0.175930848 -0.463080746  0.1095407140  800.9616 1.0084073
## bI[93]   0.855096350 0.300959261  0.371787109  1.3401777386 2148.6842 1.0014160
## bI[94]   0.253806735 0.197840480 -0.062523331  0.5687192713  857.0315 1.0044780
## bI[95]   0.101003143 0.215389013 -0.246864747  0.4402576493 1503.0544 1.0045095
## bI[96]  -0.669681119 0.500628868 -1.436556536  0.1059969665 2872.8095 1.0019187
## bI[97]  -0.183771623 0.243960997 -0.566774012  0.1858976209 1451.9360 1.0020522
## bI[98]  -0.659157882 0.157193139 -0.919852204 -0.4117203584  811.7954 1.0087652
## bI[99]  -1.097312676 0.171894022 -1.365380930 -0.8177061957  597.9670 1.0092662
## bI[100] -0.018110331 0.159693691 -0.271717570  0.2458452530  507.6535 1.0126933
## bI[101] -0.262224920 0.190579609 -0.567167618  0.0422929633  765.6682 1.0093923
## bI[102] -0.580385225 0.205032241 -0.905950838 -0.2530410620  997.5033 1.0060697
## bI[103] -0.220480297 0.754304017 -1.435418068  0.9550808316 4088.4532 0.9984995
## bI[104] -0.288667903 0.186672491 -0.581929812  0.0091231117  964.0026 1.0046297
## bI[105]  0.360112847 0.184597614  0.067083516  0.6593507573  986.9835 1.0033166
## bI[106] -0.498831793 0.168411233 -0.774218252 -0.2267661965  744.6629 1.0116956
## bI[107] -0.604886643 0.451902019 -1.292717886  0.0959207069 3354.7305 0.9998311
## bI[108]  0.523567428 0.243864784  0.138792344  0.9149776018 1702.2517 1.0012594
## bI[109] -0.986021022 0.469457633 -1.737047801 -0.2185484106 2975.7737 0.9989165
## bI[110]  0.495425969 0.196105619  0.173987730  0.8065864033 1134.6334 1.0038699
## bI[111] -0.197617867 0.262509244 -0.626869342  0.2159714249 1787.3155 1.0026619
## bI[112]  0.114320526 0.184221621 -0.179318368  0.4034086002 1013.9647 1.0054557
## bI[113] -0.069464184 0.165706091 -0.330393061  0.1962320519  842.2801 1.0056458
## bI[114]  0.528382019 0.192781232  0.228439478  0.8371447231 1034.3033 1.0042771
## bI[115] -0.922404725 0.177515647 -1.205588508 -0.6400563459  705.5818 1.0076247
## bI[116] -1.053782935 0.239830391 -1.435779530 -0.6768846976 1551.2967 1.0042036
## bI[117]  0.325604314 0.153603047  0.086840274  0.5697362729  762.4542 1.0046425
## bI[118] -0.347255653 0.145481090 -0.584454972 -0.1078437300  715.0907 1.0091490
## bI[119] -0.465776520 0.466823308 -1.201503358  0.2767296903 3253.2636 0.9995930
## bI[120] -0.414975982 0.728377824 -1.571013718  0.7590447299 3270.3327 0.9991683
## bI[121]  0.449982725 0.162980790  0.188469227  0.7110160965  828.1351 1.0075018
## bI[122]  0.029613768 0.169912480 -0.233313088  0.2961174586  858.3757 1.0085933
## bI[123]  0.259598874 0.140953930  0.029309720  0.4872127212  496.7572 1.0123872
## bI[124] -0.319162329 0.154314127 -0.560671375 -0.0709748463  653.8737 1.0081898
## bI[125] -0.382223329 0.290951655 -0.843815608  0.0773784968 2002.7085 1.0008904
## bI[126] -0.896091238 0.170834668 -1.165059784 -0.6257341073  745.7438 1.0072384
## bI[127] -0.608999019 0.186433948 -0.897171466 -0.2995075767  728.6087 1.0083451
## bI[128]  0.381498087 0.164831571  0.124886903  0.6471699088  784.0785 1.0084554
## bI[129] -0.355640764 0.175119897 -0.634356244 -0.0754583119  954.9150 1.0060466
## bI[130] -0.505561014 0.206043222 -0.840303977 -0.1835075618 1097.1424 1.0036857
## bI[131]  0.074918185 0.151020812 -0.166367339  0.3177971321  716.7735 1.0078807
## bI[132] -0.545704792 0.160896156 -0.809651176 -0.2983761422  695.8334 1.0121207
## bI[133]  0.019382868 1.001329740 -1.601673846  1.6128400024 6370.1350 0.9988671
## bI[134]  0.087673982 0.303542356 -0.409369595  0.5520905679 1744.9818 1.0039679
## bI[135] -0.878078867 0.502633424 -1.693649494 -0.0898865901 3580.1784 0.9984354
## bI[136] -0.286535083 0.152012121 -0.530336556 -0.0401568798  660.4694 1.0110804
## bI[137] -0.241796908 0.164298888 -0.509197006  0.0268006187  866.8615 1.0058817
## bI[138] -0.096938885 0.157220765 -0.348304735  0.1466901038  612.3063 1.0102383
## bI[139] -0.323869000 0.150538136 -0.568873976 -0.0858940905  675.8967 1.0121630
## bI[140] -0.655894133 0.281269712 -1.114355021 -0.2152015211 1667.4335 1.0033432
## bI[141]  0.500748699 0.142833302  0.272747697  0.7293058359  387.6865 1.0138065
## bI[142]  0.540917746 0.186080269  0.250895553  0.8389239181  945.0100 1.0049202
## bI[143]  0.622657304 0.168684544  0.356271311  0.8807768138  856.1916 1.0079162
## bI[144]  0.428723642 0.171483420  0.162713672  0.7128873559  832.8600 1.0066060
## bI[145]  0.310209883 0.195461489 -0.002547598  0.6144169613  914.4599 1.0069408
## bI[146]  0.043618293 0.150980436 -0.200574364  0.2892355565  686.2717 1.0087369
## bI[147] -0.409724814 0.170893709 -0.693467037 -0.1473511436  859.3059 1.0061766
## bI[148] -0.635742538 0.165464112 -0.900717606 -0.3761095073  713.4681 1.0092252
## bI[149] -0.386884204 0.174727165 -0.677219828 -0.1114964798  884.7060 1.0050749
## bI[150] -0.090722490 0.525971821 -0.897879948  0.7613172464 3113.6631 0.9988347
## bI[151] -0.858208912 0.193291206 -1.170461141 -0.5595914656  936.1927 1.0062023
## bI[152] -0.505527274 0.183969518 -0.803138664 -0.2139351728  804.2814 1.0087024
## bI[153] -0.317888608 0.181529336 -0.604312611 -0.0286553529 1178.2684 1.0044734
## bI[154] -0.554047707 0.174587745 -0.832508393 -0.2750165620  786.7106 1.0063658
## bI[155]  0.534251451 0.262060159  0.118469600  0.9416608032 1108.2920 1.0059528
## bI[156] -0.025301234 0.168485562 -0.296973284  0.2366956394  785.5693 1.0062780
## bI[157] -0.334905293 0.791245297 -1.605193586  0.9473593905 4130.8392 0.9993242
## bI[158]  0.157044738 0.198009984 -0.166240639  0.4816950365  831.3117 1.0102369
## bI[159]  0.040495613 0.197753623 -0.280854123  0.3604955974 1071.4413 1.0066561
## bI[160] -0.688981467 0.174722524 -0.975245484 -0.4043620613  905.4563 1.0052940
## bI[161]  0.205494672 0.157665782 -0.041127686  0.4624075294  634.6016 1.0095190
## bI[162]  0.306399417 0.162222141  0.053187730  0.5589608286  521.3439 1.0103840
## bI[163]  0.066610826 0.192062069 -0.244291028  0.3676927775 1220.5103 1.0037425
## bI[164] -0.073421855 0.185357519 -0.365606348  0.2131286371 1239.0596 1.0067401
## bI[165] -0.012268956 0.143740543 -0.236523461  0.2200673236  575.2835 1.0111702
## bI[166]  0.215108327 0.190972022 -0.086256716  0.5203853829  967.1923 1.0064577
## bI[167] -0.177962098 0.186365789 -0.462393496  0.1200741364  928.7264 1.0059249
## bI[168] -0.133485267 0.167913827 -0.413371789  0.1327447307  631.5434 1.0087411
## bI[169] -0.223217942 0.163456682 -0.488656211  0.0370557237  677.5905 1.0095959
## bI[170] -0.478514113 0.168612651 -0.747242383 -0.2126677819  801.3958 1.0079581
## bI[171] -0.199061962 0.149105956 -0.436398728  0.0332805223  441.3069 1.0104333
## bI[172]  0.500614017 0.158193631  0.247016464  0.7535096378  727.9481 1.0094066
## bI[173] -0.567397668 0.152994192 -0.811443306 -0.3214578344  649.7940 1.0068510
## bI[174] -0.554847062 0.773156120 -1.766396633  0.6994587810 4339.5431 0.9985706
## bI[175] -0.542919897 0.164457348 -0.803938849 -0.2728148985  838.9855 1.0062059
## bI[176] -0.411833874 0.167692279 -0.681038958 -0.1524133646  852.8365 1.0081438
## bI[177] -0.456030128 0.153900130 -0.694008283 -0.2168690903  539.1984 1.0074834
## bI[178] -1.055533558 0.146710322 -1.284397184 -0.8207339968  666.6947 1.0103892
## bI[179] -0.776684327 0.165638277 -1.044166258 -0.5114444642  720.0020 1.0076002
## sigma    0.576580350 0.004048279  0.570457703  0.5832257601 2640.7445 0.9987617
```

```r
plot( precis(modle_fixed) )
```

```
## 510 vector or matrix parameters hidden. Use depth=2 to show them.
```

![](chpater14-3-hypocotyl_files/figure-html/unnamed-chunk-4-1.png)<!-- -->

### 2.partial pooling across plate_exp


```r
modle_multilevel <- ulam(
  alist(
    length ~ dnorm(mu, sigma),
    mu <- a[line] + bI[line]*light + bP[plate_exp],
    a[line] ~ dnorm(a_bar, sigma_a),
    bI[line] ~ dnorm(0, 1),
    bP[plate_exp] ~ dnorm(0, sigma_p),
    a_bar ~ dnorm( 0 , 1 ),
    sigma_a ~ dexp(1),
    sigma_p ~ dexp(1),
    sigma ~ dexp(1)
  ), data=dat_list , chains=4 , cores=4 , log_lik=TRUE)

precis( modle_multilevel, depth=2 , pars=c("bI","sigma"))
```

```
##                 mean          sd         5.5%         94.5%     n_eff      Rhat
## bI[1]   -0.234286026 0.171695873 -0.521572992  0.0395952575 1242.2696 1.0003765
## bI[2]   -0.715662295 0.163921547 -0.978816463 -0.4567536156 1132.4715 1.0022871
## bI[3]   -1.308521044 0.252426018 -1.714449082 -0.9037481913 2277.5210 0.9998208
## bI[4]   -0.504036365 0.169090233 -0.776404502 -0.2358317546 1710.6274 0.9993142
## bI[5]   -0.302146684 0.169859136 -0.574453590 -0.0342364336 1646.8991 0.9991426
## bI[6]   -0.057395858 0.148991782 -0.295011051  0.1755663344 1194.6268 0.9995067
## bI[7]   -0.581309871 0.181271567 -0.866603382 -0.2958240725 1832.8902 1.0013388
## bI[8]   -0.789752106 0.243672089 -1.183162517 -0.4031144893 2455.3415 0.9992733
## bI[9]   -0.934591356 0.454754815 -1.658253868 -0.2101335248 3106.9160 1.0000875
## bI[10]  -0.671770048 0.517200049 -1.495408344  0.1542483306 3622.2941 0.9991369
## bI[11]  -0.901753109 0.163031309 -1.162328656 -0.6471733297  987.7736 1.0013577
## bI[12]  -0.451574951 0.179690500 -0.742119654 -0.1738843842 1746.1733 1.0008750
## bI[13]  -0.661532552 0.146948490 -0.894115628 -0.4271088679 1254.6572 0.9995225
## bI[14]  -0.436065341 0.180065358 -0.712937836 -0.1490725926 1338.5631 1.0006210
## bI[15]  -0.443711457 0.192733597 -0.749972307 -0.1387931546 1498.3426 0.9997715
## bI[16]  -0.695617409 0.161691269 -0.945516966 -0.4339258110 1117.3017 1.0015814
## bI[17]  -0.733382132 0.171649448 -1.006875602 -0.4617432701 1502.9476 1.0008973
## bI[18]  -0.878271026 0.255211775 -1.289208070 -0.4871129344 2665.9034 0.9994645
## bI[19]  -0.502430516 0.185189457 -0.796660010 -0.2147062593 1763.4301 1.0013922
## bI[20]  -0.602654692 0.141527568 -0.838826938 -0.3737574891  998.3158 1.0013492
## bI[21]  -0.688228982 0.157473393 -0.943288300 -0.4326863970 1193.2137 0.9995683
## bI[22]  -1.161718522 0.140177334 -1.384293726 -0.9426094303 1112.8553 1.0042734
## bI[23]  -1.007528587 0.149684343 -1.254426119 -0.7683965948 1116.2132 1.0019658
## bI[24]   0.119625986 0.171961066 -0.148188956  0.3917938943 1245.3438 0.9997719
## bI[25]  -0.364278824 0.155631252 -0.602029265 -0.1113143276 1223.6144 1.0018031
## bI[26]  -0.692579014 0.347496442 -1.235071874 -0.1306463428 3477.4181 0.9991082
## bI[27]  -0.745112980 0.165395545 -1.002149269 -0.4757473698 1471.5302 0.9999362
## bI[28]  -1.321478868 0.156247015 -1.572112558 -1.0728298091 1066.5822 1.0022676
## bI[29]  -0.687476386 0.215409657 -1.035284075 -0.3335389390 1966.7925 0.9991608
## bI[30]  -0.028147492 0.142399369 -0.252142494  0.2070775424 1094.9128 1.0003574
## bI[31]  -1.251330529 0.159189747 -1.514365366 -1.0001279985 1466.9362 1.0014714
## bI[32]  -1.140692782 0.450751771 -1.873166709 -0.4507555965 3304.3997 0.9995788
## bI[33]  -1.043924982 0.167166627 -1.308565145 -0.7731721292 1369.3609 1.0020766
## bI[34]  -0.154347226 0.143006592 -0.382524449  0.0737653353 1038.3714 1.0004965
## bI[35]  -0.166240852 0.157734918 -0.406798729  0.0873178956  982.9263 1.0007249
## bI[36]  -0.523136140 0.146452544 -0.755962190 -0.2837270953 1337.4579 1.0002171
## bI[37]  -0.456771166 0.146865003 -0.691901412 -0.2212103967 1269.2581 1.0006515
## bI[38]  -0.755172381 0.135473075 -0.976142304 -0.5348146416 1017.4822 1.0051851
## bI[39]  -0.679622469 0.141125139 -0.907791375 -0.4512905164  981.1532 1.0002948
## bI[40]   0.154786162 0.573965613 -0.774770746  1.0701919682 4050.2982 0.9991422
## bI[41]   0.750026220 0.156485004  0.500395012  1.0000378630 1146.3504 1.0033642
## bI[42]  -1.409581254 0.147655617 -1.646497871 -1.1733493698 1005.8100 0.9999813
## bI[43]  -0.328225811 0.180032570 -0.612102108 -0.0299429372 1554.8313 1.0001870
## bI[44]  -0.907585753 0.232812371 -1.275630996 -0.5234429675 2498.4100 0.9986482
## bI[45]  -0.272086543 0.237481002 -0.640055906  0.1071390338 2698.9688 0.9988741
## bI[46]  -0.250669712 0.178425911 -0.531851443  0.0344147478 1630.5989 1.0026924
## bI[47]  -0.172825748 0.169458451 -0.448290540  0.0988979913 1284.6333 1.0003899
## bI[48]  -0.522769264 0.148048542 -0.760330750 -0.2792024704 1000.1293 1.0020065
## bI[49]  -0.328912134 0.172405605 -0.600235580 -0.0478490879 1370.1785 1.0020887
## bI[50]  -0.110486132 0.144443744 -0.334941132  0.1237600889  975.3002 0.9995324
## bI[51]  -0.230807760 0.146973214 -0.468024519  0.0035917540  877.5133 1.0030180
## bI[52]  -0.353255094 0.164463344 -0.617675150 -0.0965660552 1267.1795 0.9996351
## bI[53]   0.086663931 0.182438887 -0.201343236  0.3741667342 2048.8540 0.9994019
## bI[54]  -0.702939014 0.160897272 -0.950125001 -0.4431635932 1518.7131 1.0026049
## bI[55]  -0.223453015 0.229699979 -0.578876728  0.1575802715 2278.3461 1.0007729
## bI[56]  -0.930843875 0.147540777 -1.164187567 -0.7008136876 1169.7418 1.0016178
## bI[57]  -0.557671704 0.193655865 -0.865058200 -0.2430381729 2092.5719 1.0000852
## bI[58]  -0.404929021 0.168554468 -0.672119992 -0.1340052195 1648.4420 1.0001669
## bI[59]  -0.748655125 0.159653147 -1.007613430 -0.4942433351 1383.4257 0.9988974
## bI[60]  -0.113849662 0.140440919 -0.330038119  0.1102951849 1167.8981 0.9992402
## bI[61]  -1.117902476 0.170552426 -1.388665664 -0.8409550009 1606.1336 1.0000218
## bI[62]  -0.239819327 0.150679057 -0.478097945 -0.0009012069 1089.3929 1.0018153
## bI[63]  -0.234343572 0.172658131 -0.504867198  0.0348889735 1463.1585 0.9999300
## bI[64]  -0.825537033 0.153275148 -1.066776326 -0.5782680473 1007.6218 1.0016930
## bI[65]  -0.646315495 0.169196201 -0.926607316 -0.3780362186 1261.3279 0.9986895
## bI[66]  -0.706535682 0.158054133 -0.960424725 -0.4564129181 1043.9878 1.0030052
## bI[67]  -0.980507531 0.332095458 -1.505542768 -0.4369378642 4159.5513 0.9989674
## bI[68]   0.062093286 0.146637466 -0.164305883  0.2933360945 1144.6982 1.0007246
## bI[69]  -0.538382180 0.165264329 -0.799360343 -0.2763248364 1282.9397 0.9993636
## bI[70]  -1.386870811 0.188648098 -1.683512449 -1.0821102111 1719.5005 0.9997697
## bI[71]  -0.737981919 0.196739925 -1.048312074 -0.4154877368 1879.3302 1.0003110
## bI[72]   0.119068298 0.146010081 -0.114453140  0.3502870258  991.0545 1.0005032
## bI[73]  -0.517127970 0.617661387 -1.464816807  0.4665907893 3707.5618 0.9988498
## bI[74]  -0.156560859 0.157574398 -0.410859318  0.1037240607 1218.1851 1.0031071
## bI[75]   0.067419465 0.147058593 -0.168623741  0.2912192346 1080.0167 1.0002571
## bI[76]  -0.077209653 0.159752364 -0.331671462  0.1775152528 1290.2728 1.0019027
## bI[77]  -0.502661676 0.179853404 -0.783721768 -0.2105244103 1592.0714 1.0009469
## bI[78]   0.085474431 0.136033969 -0.124711494  0.3063731774 1047.1024 1.0048098
## bI[79]   0.001487930 0.154211859 -0.247087830  0.2506742642 1187.2283 1.0001790
## bI[80]  -0.161186428 0.195061554 -0.474617765  0.1594495395 2099.2290 1.0000113
## bI[81]  -0.015837095 1.010955134 -1.588834703  1.6126170751 3572.6353 0.9988919
## bI[82]  -0.534490986 0.148237689 -0.774352061 -0.2922784537 1105.0738 0.9988793
## bI[83]  -0.547468281 0.148681565 -0.786583586 -0.3090934793  994.5565 1.0022623
## bI[84]  -0.003672014 0.990798323 -1.602951255  1.5615958648 4477.8212 0.9987259
## bI[85]  -0.146565321 0.168060332 -0.419541138  0.1254339916 1469.3895 1.0013318
## bI[86]  -0.418376512 0.238105844 -0.801442509 -0.0416567311 2501.8242 1.0011158
## bI[87]  -1.162438382 0.213354679 -1.489650468 -0.8190535108 1873.7458 1.0005476
## bI[88]  -0.142823461 0.142706078 -0.374133331  0.0786455594 1296.0584 1.0001538
## bI[89]  -1.332591638 0.402814342 -1.968238812 -0.6866497116 3126.2544 0.9990547
## bI[90]   0.169589789 0.186821976 -0.128532735  0.4645247076 2291.0412 0.9994494
## bI[91]   0.040232036 0.214116769 -0.291587116  0.3862430295 1996.9869 1.0001384
## bI[92]  -0.529203308 0.162561595 -0.796185064 -0.2687166472 1247.0361 0.9994891
## bI[93]   0.499068783 0.296085434  0.023196132  0.9659635999 3060.6268 1.0004493
## bI[94]  -0.124405907 0.195160136 -0.444267385  0.1775756790 2061.8031 0.9993887
## bI[95]  -0.194489024 0.202529310 -0.515504368  0.1275231550 1497.3672 0.9995797
## bI[96]  -1.107416474 0.452432402 -1.810899318 -0.3614756240 4332.1868 0.9989719
## bI[97]  -0.583303468 0.244264401 -0.976794289 -0.1977589080 2034.3748 1.0003685
## bI[98]  -1.046311812 0.152305218 -1.285682870 -0.7973906330 1071.0297 1.0019004
## bI[99]  -1.452483814 0.160546084 -1.702762572 -1.2006830947 1655.1297 1.0005847
## bI[100] -0.391430430 0.145233265 -0.620286570 -0.1618222596 1098.9785 1.0019029
## bI[101] -0.646036281 0.181167219 -0.932534642 -0.3564022836 1549.9127 0.9998524
## bI[102] -0.943981800 0.191899970 -1.248036824 -0.6270594114 1839.2954 1.0019905
## bI[103] -0.621861615 0.566643970 -1.533739713  0.2717772388 4193.0952 1.0007992
## bI[104] -0.672409379 0.181989211 -0.964449917 -0.3811661055 1690.0652 1.0015190
## bI[105]  0.013367064 0.182777872 -0.286380569  0.3040295573 1085.0844 1.0017762
## bI[106] -0.847835010 0.168037204 -1.102277996 -0.5798564954 1475.6095 1.0012745
## bI[107] -0.986987157 0.393551180 -1.602460528 -0.3703338602 3568.6094 0.9991730
## bI[108]  0.033461742 0.228062800 -0.322391933  0.3928148532 2439.0145 1.0002500
## bI[109] -1.333176978 0.421940179 -2.010893762 -0.6655408976 4363.0805 0.9984679
## bI[110]  0.116560181 0.194328600 -0.195348931  0.4229576408 1072.2341 0.9997321
## bI[111] -0.650408752 0.250638245 -1.050684000 -0.2546979112 2587.4975 0.9994039
## bI[112] -0.287883183 0.179459379 -0.578990502 -0.0050110584 1314.5265 1.0004884
## bI[113] -0.486672148 0.159296283 -0.746565086 -0.2246242667 1047.9645 0.9985730
## bI[114]  0.163153045 0.180336236 -0.132417386  0.4541444041 1590.1512 1.0001226
## bI[115] -1.294495158 0.168803080 -1.562972093 -1.0239964906 1556.7858 0.9996796
## bI[116] -1.421884352 0.236968511 -1.793428567 -1.0462343110 2037.6219 1.0018124
## bI[117] -0.059500741 0.148893655 -0.294982766  0.1818435132 1046.7043 1.0004864
## bI[118] -0.732229931 0.141208691 -0.955194790 -0.5046377884  814.5295 1.0038396
## bI[119] -0.930308238 0.436008708 -1.641613874 -0.2560113880 3296.5398 0.9996532
## bI[120] -0.834420501 0.577226936 -1.741912622  0.0623041552 4114.9480 0.9987576
## bI[121]  0.054586426 0.160509705 -0.195693633  0.3118208869 1203.1346 0.9987732
## bI[122] -0.335844101 0.171319199 -0.598047974 -0.0555668580 1447.6667 1.0002219
## bI[123] -0.113133029 0.136657288 -0.344050389  0.1016641233  787.7464 1.0029498
## bI[124] -0.718774460 0.148224379 -0.957515879 -0.4864266984 1179.9884 1.0000060
## bI[125] -0.750530947 0.291822457 -1.204063984 -0.2831940488 2677.3130 0.9985192
## bI[126] -1.252496698 0.163814453 -1.513074112 -0.9937869434 1344.8726 1.0012058
## bI[127] -1.006740876 0.174453647 -1.291284015 -0.7352034946 1586.9325 1.0023747
## bI[128]  0.011002909 0.158297851 -0.236675501  0.2605286647 1111.1255 1.0002939
## bI[129] -0.744161874 0.174178408 -1.018723812 -0.4657534875 1664.9173 1.0014129
## bI[130] -0.873777700 0.205265760 -1.215542074 -0.5549181722 1888.8284 1.0001151
## bI[131] -0.314796610 0.146589920 -0.546362172 -0.0750213449 1009.2441 1.0017826
## bI[132] -0.908860532 0.150312638 -1.146285932 -0.6686246646 1083.8821 0.9999951
## bI[133]  0.020307181 0.973484812 -1.513029682  1.6599412567 3964.5175 0.9989215
## bI[134] -0.317433321 0.297655103 -0.789126774  0.1720154370 2694.4531 0.9997347
## bI[135] -1.371017273 0.436732817 -2.060814053 -0.6970278657 5225.0880 0.9993383
## bI[136] -0.686363329 0.143300531 -0.914033021 -0.4583986904 1117.0599 1.0011727
## bI[137] -0.652531360 0.162407770 -0.908995770 -0.3893424451 1443.3824 0.9996398
## bI[138] -0.480225762 0.157477953 -0.731671366 -0.2224232886 1356.2075 0.9987582
## bI[139] -0.709917412 0.146303586 -0.941729388 -0.4820010530  904.3575 1.0000635
## bI[140] -0.945905852 0.279459309 -1.390424123 -0.5039582118 2896.7257 0.9993291
## bI[141]  0.113075566 0.142752696 -0.113172709  0.3376425577  868.9786 1.0015964
## bI[142]  0.126485362 0.179415677 -0.167765480  0.4013769071 1527.6794 1.0004676
## bI[143]  0.264982582 0.163101999  0.001159759  0.5331195021 1421.6205 0.9992665
## bI[144]  0.042834058 0.158900558 -0.214592573  0.2971328581 1329.7696 1.0007067
## bI[145] -0.067832386 0.182305481 -0.365163893  0.2281864216 1636.8606 1.0003643
## bI[146] -0.337387655 0.145177447 -0.571839895 -0.1039901526  923.0968 0.9996707
## bI[147] -0.787532963 0.171196377 -1.058278263 -0.5135352002 1075.9602 1.0033500
## bI[148] -1.009096874 0.162217714 -1.270495235 -0.7478050371 1309.4880 1.0016571
## bI[149] -0.777918752 0.166837017 -1.048060436 -0.5060523184 1460.1177 1.0005914
## bI[150] -0.360498092 0.454317447 -1.071173208  0.3530639039 4274.9889 0.9984606
## bI[151] -1.226427411 0.174676932 -1.505082263 -0.9437018951 1442.6777 0.9998443
## bI[152] -0.899520677 0.167024059 -1.160919630 -0.6352054134 1500.1739 0.9996076
## bI[153] -0.686929147 0.171236464 -0.964783926 -0.4116778025 1573.1895 1.0003915
## bI[154] -0.920636450 0.168859445 -1.187881524 -0.6492965395 1798.2995 0.9998711
## bI[155]  0.178980484 0.243652462 -0.190880589  0.5665293190 2448.4225 1.0020744
## bI[156] -0.416740038 0.161802122 -0.672392463 -0.1582031965 1384.4528 1.0023291
## bI[157] -0.709184472 0.638416266 -1.741038442  0.3039481624 3719.8443 0.9995097
## bI[158] -0.218410537 0.183155420 -0.514631386  0.0747587080 1573.8658 1.0014884
## bI[159] -0.359786641 0.195932293 -0.677403478 -0.0554168653 1674.2920 0.9994660
## bI[160] -1.056499947 0.165436148 -1.316866406 -0.7897138413 1044.7633 1.0019622
## bI[161] -0.182887244 0.150920602 -0.423437336  0.0605581909  887.0975 1.0018518
## bI[162] -0.088443407 0.159185737 -0.338612629  0.1700552115 1176.2786 0.9997260
## bI[163] -0.316896372 0.189966012 -0.617601442 -0.0081354649 1559.5754 1.0003689
## bI[164] -0.494617745 0.178985934 -0.782645764 -0.2117642858 1561.4389 1.0018375
## bI[165] -0.413017151 0.141615699 -0.630202122 -0.1904352375 1143.5379 1.0034183
## bI[166] -0.190423324 0.192090922 -0.501732574  0.1123175250 1896.2853 0.9990017
## bI[167] -0.522089881 0.173714341 -0.798461771 -0.2443377568 1966.0945 0.9996700
## bI[168] -0.536886351 0.163783993 -0.794455083 -0.2768140736  949.2715 1.0006053
## bI[169] -0.602981610 0.150290871 -0.835572552 -0.3663827640 1069.4571 0.9996144
## bI[170] -0.858533924 0.166292913 -1.126872973 -0.5933070423 1174.9248 1.0014651
## bI[171] -0.562516292 0.145956931 -0.792586326 -0.3323340220 1238.1310 1.0004946
## bI[172]  0.153590716 0.157660541 -0.096565624  0.4139206216 1251.2254 1.0018904
## bI[173] -0.950428852 0.147050346 -1.182552482 -0.7173573674 1089.0680 1.0011773
## bI[174] -0.992874584 0.621862063 -2.001642965  0.0004419362 3369.8029 0.9990687
## bI[175] -0.914156678 0.154952029 -1.164159376 -0.6717960084 1397.7640 1.0015398
## bI[176] -0.738955762 0.162566954 -0.997905510 -0.4790633879 1308.8316 1.0005752
## bI[177] -0.850926503 0.155269789 -1.093695996 -0.6063699579 1238.4916 0.9998053
## bI[178] -1.450105217 0.140447079 -1.671987437 -1.2249186328  942.8724 1.0025293
## bI[179] -1.149851273 0.151127429 -1.387672161 -0.9036040524 1456.6124 1.0018196
## sigma    0.576478818 0.004377034  0.569387937  0.5833545555 2727.4644 0.9991606
```

```r
plot(precis( modle_multilevel ))
```

```
## 510 vector or matrix parameters hidden. Use depth=2 to show them.
```

![](chpater14-3-hypocotyl_files/figure-html/unnamed-chunk-5-1.png)<!-- -->


```r
compare(modle_base, modle_fixed, modle_multilevel)
```

```
##                      WAIC       SE      dWAIC       dSE    pWAIC       weight
## modle_multilevel 17848.03 178.7863    0.00000        NA 458.9954 0.9996427552
## modle_fixed      17863.90 179.0312   15.87346  7.606169 474.7010 0.0003572448
## modle_base       19608.32 168.1858 1760.29118 86.645756 317.3451 0.0000000000
```

```r
plot(compare(modle_base, modle_fixed, modle_multilevel))
```

![](chpater14-3-hypocotyl_files/figure-html/unnamed-chunk-6-1.png)<!-- -->

### 3.As 2, but use a multivariate normal model for the line slope and intercept effects


```r
modle_base_multivariate <- ulam(
    alist(
        length ~ normal(mu, sigma),
        mu <- a[line] + bI[line]*light,
        c(a,bI)[line] ~ multi_normal( c(a_bar,b_bar) , Rho , sigma_line ),
        a_bar ~ normal(0,1),
        b_bar ~ normal(0,1),
        sigma_line ~ exponential(1),
        sigma ~ exponential(1),
        Rho ~ lkj_corr(2)
    ) , data=dat_list1 , chains=4 , cores=4, log_lik = TRUE )
```

```
## Warning: There were 19 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See
## http://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded
```

```
## Warning: Examine the pairs() plot to diagnose sampling problems
```

```r
precis(modle_base_multivariate, depth=3 , pars=c("Rho","sigma_line"))
```

```
##                    mean           sd        5.5%     94.5%    n_eff      Rhat
## Rho[1,1]      1.0000000 0.000000e+00  1.00000000 1.0000000      NaN       NaN
## Rho[1,2]      0.1083309 8.400689e-02 -0.02323839 0.2416851 1807.768 1.0002182
## Rho[2,1]      0.1083309 8.400689e-02 -0.02323839 0.2416851 1807.768 1.0002182
## Rho[2,2]      1.0000000 9.948128e-17  1.00000000 1.0000000 1909.883 0.9979980
## sigma_line[1] 0.5681449 3.395846e-02  0.51579280 0.6253312 1780.067 0.9991329
## sigma_line[2] 0.4272377 2.812287e-02  0.38202395 0.4720378 2195.971 1.0005905
```


```r
compare(modle_base, modle_fixed, modle_multilevel,modle_base_multivariate)
```

```
##                             WAIC       SE      dWAIC       dSE    pWAIC
## modle_multilevel        17848.03 178.7863    0.00000        NA 458.9954
## modle_fixed             17863.90 179.0312   15.87346  7.606169 474.7010
## modle_base_multivariate 19587.45 167.8765 1739.42629 86.926626 295.0630
## modle_base              19608.32 168.1858 1760.29118 86.645756 317.3451
##                               weight
## modle_multilevel        0.9996427552
## modle_fixed             0.0003572448
## modle_base_multivariate 0.0000000000
## modle_base              0.0000000000
```

```r
plot(compare(modle_base, modle_fixed, modle_multilevel,modle_base_multivariate))
```

![](chpater14-3-hypocotyl_files/figure-html/unnamed-chunk-8-1.png)<!-- -->


```r
modle_fixed_multivariate <- ulam(
    alist(
        length ~ normal(mu, sigma),
        mu <- a[line] + bI[line]*light + bP[plate_exp],
        c(a,bI)[line] ~ multi_normal( c(a_bar,b_bar) , Rho , sigma_line ),
        a_bar ~ normal(0,1),
        b_bar ~ normal(0,1),
        bP[plate_exp] ~ dnorm(0, 1),
        sigma_line ~ exponential(1),
        sigma ~ exponential(1),
        Rho ~ lkj_corr(2)
    ) , data=dat_list , chains=4 , cores=4, log_lik = TRUE )
```

```
## Warning: The largest R-hat is 1.31, indicating chains have not mixed.
## Running the chains for more iterations may help. See
## http://mc-stan.org/misc/warnings.html#r-hat
```

```
## Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
## Running the chains for more iterations may help. See
## http://mc-stan.org/misc/warnings.html#bulk-ess
```

```
## Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
## Running the chains for more iterations may help. See
## http://mc-stan.org/misc/warnings.html#tail-ess
```

```r
precis(modle_fixed_multivariate, depth=3 , pars=c("Rho","sigma_line"))
```

```
##                    mean           sd         5.5%     94.5%    n_eff      Rhat
## Rho[1,1]      1.0000000 0.000000e+00  1.000000000 1.0000000      NaN       NaN
## Rho[1,2]      0.1324010 8.671755e-02 -0.005389822 0.2661962 2399.313 0.9992380
## Rho[2,1]      0.1324010 8.671755e-02 -0.005389822 0.2661962 2399.313 0.9992380
## Rho[2,2]      1.0000000 9.419638e-17  1.000000000 1.0000000 1821.646 0.9979980
## sigma_line[1] 0.5760412 3.192239e-02  0.527210006 0.6270127 2688.629 0.9997825
## sigma_line[2] 0.4083082 2.722078e-02  0.366369411 0.4545717 2046.419 1.0000389
```


```r
compare(modle_base, modle_fixed, modle_multilevel,modle_base_multivariate,modle_fixed_multivariate)
```

```
##                              WAIC       SE      dWAIC      dSE    pWAIC
## modle_fixed_multivariate 17841.86 178.7344    0.00000       NA 447.0725
## modle_multilevel         17848.03 178.7863    6.16524 11.57548 458.9954
## modle_fixed              17863.90 179.0312   22.03870 10.93192 474.7010
## modle_base_multivariate  19587.45 167.8765 1745.59153 90.87064 295.0630
## modle_base               19608.32 168.1858 1766.45642 91.46132 317.3451
##                                weight
## modle_fixed_multivariate 9.561551e-01
## modle_multilevel         4.382920e-02
## modle_fixed              1.566335e-05
## modle_base_multivariate  0.000000e+00
## modle_base               0.000000e+00
```

```r
plot(compare(modle_base, modle_fixed, modle_multilevel,modle_base_multivariate,modle_fixed_multivariate))
```

![](chpater14-3-hypocotyl_files/figure-html/unnamed-chunk-10-1.png)<!-- -->

### multivariate normal model with varying slopes model


```r
# dat_list2 <- list(
#   length = scale(hyp_s$length),
#   line = as.integer(as.factor(hyp_s$line)),
#   light = ifelse(hyp_s$light=="H", 1L , 2L )
# )
# head(dat_list2)
# 
# modle_base_multivariate_varying_slope <- ulam(
#     alist(
#         length ~ normal(mu, sigma),
#         mu <- g[line] + alpha[line, light],
#         
#         # adaptive priors
#         vector[180]:alpha[line] ~ multi_normal(0,Rho_line,sigma_line),
#         
#         # fixed priors
#         g[line] ~ dnorm( 0 , 1 ),
#         sigma_line ~ dexp(1),
#         Rho_line ~ dlkjcorr(4)
#     ), data=dat_list2 , chains=4 , cores=4 , log_lik = TRUE)
# 
# precis(modle_base_multivariate_varying_slope, depth=2)
```

