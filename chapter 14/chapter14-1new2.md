---
author: 'Min-Yao'
generator: pandoc
title: 'chapter 14-1'
viewport: 'width=device-width, initial-scale=1'
---

::: {.container-fluid .main-container}
::: {#header .fluid-row}
chapter 14-1 {#chapter-14-1 .title .toc-ignore}
============

#### Min-Yao {#min-yao .author}

#### 2020/3/5 {#section .date}
:::

::: {#adventures-in-covariance .section .level1}
14 Adventures in Covariance
===========================

::: {#varying-slopes-by-construction .section .level2}
14.1. Varying slopes by construction
------------------------------------

::: {#simulate-the-population. .section .level3}
### 14.1.1. Simulate the population.

``` {.r}
library(rethinking)
```

    ## Loading required package: rstan

    ## Loading required package: StanHeaders

    ## Loading required package: ggplot2

    ## rstan (Version 2.19.2, GitRev: 2e1f913d3ca3)

    ## For execution on a local, multicore CPU with excess RAM we recommend calling
    ## options(mc.cores = parallel::detectCores()).
    ## To avoid recompilation of unchanged Stan programs, we recommend calling
    ## rstan_options(auto_write = TRUE)

    ## For improved execution time, we recommend calling
    ## Sys.setenv(LOCAL_CPPFLAGS = '-march=native')
    ## although this causes Stan to throw an error on a few processors.

    ## Loading required package: parallel

    ## Loading required package: dagitty

    ## rethinking (Version 1.93)

    ## 
    ## Attaching package: 'rethinking'

    ## The following object is masked from 'package:stats':
    ## 
    ##     rstudent

``` {.r}
## R code 14.1
a <- 3.5            # average morning wait time
b <- (-1)           # average difference afternoon wait time
sigma_a <- 1        # std dev in intercepts
sigma_b <- 0.5      # std dev in slopes
rho <- (-0.7)       # correlation between intercepts and slopes

## R code 14.2
Mu <- c( a , b )

## R code 14.3
cov_ab <- sigma_a*sigma_b*rho
Sigma <- matrix( c(sigma_a^2,cov_ab,cov_ab,sigma_b^2) , ncol=2 )

## R code 14.4
matrix( c(1,2,3,4) , nrow=2 , ncol=2 )
```

    ##      [,1] [,2]
    ## [1,]    1    3
    ## [2,]    2    4

``` {.r}
## R code 14.5
sigmas <- c(sigma_a,sigma_b) # standard deviations
Rho <- matrix( c(1,rho,rho,1) , nrow=2 ) # correlation matrix

# now matrix multiply to get covariance matrix
Sigma <- diag(sigmas) %*% Rho %*% diag(sigmas)

## R code 14.6
N_cafes <- 20

## R code 14.7
library(MASS)
set.seed(5) # used to replicate example
vary_effects <- mvrnorm( N_cafes , Mu , Sigma )

## R code 14.8
a_cafe <- vary_effects[,1]
b_cafe <- vary_effects[,2]

## R code 14.9
plot( a_cafe , b_cafe , col=rangi2,
    xlab="intercepts (a_cafe)" , ylab="slopes (b_cafe)" )

# overlay population distribution
library(ellipse)
```

    ## Warning: package 'ellipse' was built under R version 3.6.3

    ## 
    ## Attaching package: 'ellipse'

    ## The following object is masked from 'package:rethinking':
    ## 
    ##     pairs

    ## The following object is masked from 'package:graphics':
    ## 
    ##     pairs

``` {.r}
for ( l in c(0.1,0.3,0.5,0.8,0.99) )
    lines(ellipse(Sigma,centre=Mu,level=l),col=col.alpha("black",0.2))
```

![](data:image/png;base64,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)
:::

::: {#simulate-observations. .section .level3}
### 14.1.2. Simulate observations.

``` {.r}
## R code 14.10
set.seed(22)
N_visits <- 10
afternoon <- rep(0:1,N_visits*N_cafes/2)
cafe_id <- rep( 1:N_cafes , each=N_visits )
mu <- a_cafe[cafe_id] + b_cafe[cafe_id]*afternoon
sigma <- 0.5  # std dev within cafes
wait <- rnorm( N_visits*N_cafes , mu , sigma )
d <- data.frame( cafe=cafe_id , afternoon=afternoon , wait=wait )
```
:::

::: {#the-varying-slopes-model. .section .level3}
### 14.1.3. The varying slopes model.

``` {.r}
## R code 14.11
R <- rlkjcorr( 1e4 , K=2 , eta=2 )
dens( R[,1,2] , xlab="correlation" )
```

![](data:image/png;base64,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)

``` {.r}
### Rho ~ lkj_corr(2)
## R code 14.12
m14.1 <- ulam(
    alist(
        wait ~ normal( mu , sigma ),
        mu <- a_cafe[cafe] + b_cafe[cafe]*afternoon,
        c(a_cafe,b_cafe)[cafe] ~ multi_normal( c(a,b) , Rho , sigma_cafe ),
        a ~ normal(5,2),
        b ~ normal(-1,0.5),
        sigma_cafe ~ exponential(1),
        sigma ~ exponential(1),
        Rho ~ lkj_corr(2)
    ) , data=d , chains=4 , cores=4, log_lik = TRUE )

## R code 14.13
post <- extract.samples(m14.1)
dens( post$Rho[,1,2] )
```

![](data:image/png;base64,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)

``` {.r}
precis(m14.1)
```

    ## 46 vector or matrix parameters hidden. Use depth=2 to show them.

    ##             mean         sd      5.5%      94.5%    n_eff      Rhat
    ## a      3.6468261 0.21821411  3.297086  3.9969304 2564.340 0.9987379
    ## b     -1.1319608 0.14579208 -1.367303 -0.8979367 2314.553 0.9992617
    ## sigma  0.4739048 0.02684926  0.433027  0.5189561 1702.855 1.0022265

``` {.r}
### Rho ~ lkj_corr(1)
## R code 14.12
m14.1_c1 <- ulam(
    alist(
        wait ~ normal( mu , sigma ),
        mu <- a_cafe[cafe] + b_cafe[cafe]*afternoon,
        c(a_cafe,b_cafe)[cafe] ~ multi_normal( c(a,b) , Rho , sigma_cafe ),
        a ~ normal(5,2),
        b ~ normal(-1,0.5),
        sigma_cafe ~ exponential(1),
        sigma ~ exponential(1),
        Rho ~ lkj_corr(1)
    ) , data=d , chains=4 , cores=4, log_lik = TRUE )

## R code 14.13
post <- extract.samples(m14.1_c1)
dens( post$Rho[,1,2] )
```

![](data:image/png;base64,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)

``` {.r}
precis(m14.1_c1)
```

    ## 46 vector or matrix parameters hidden. Use depth=2 to show them.

    ##             mean         sd       5.5%      94.5%    n_eff      Rhat
    ## a      3.6553533 0.22125231  3.3140332  4.0099782 2417.997 0.9992763
    ## b     -1.1399351 0.14128148 -1.3586341 -0.9118614 2883.671 0.9988086
    ## sigma  0.4740647 0.02678603  0.4330486  0.5171705 2562.127 1.0011158

``` {.r}
### Rho ~ lkj_corr(5)
## R code 14.12
m14.1_c5 <- ulam(
    alist(
        wait ~ normal( mu , sigma ),
        mu <- a_cafe[cafe] + b_cafe[cafe]*afternoon,
        c(a_cafe,b_cafe)[cafe] ~ multi_normal( c(a,b) , Rho , sigma_cafe ),
        a ~ normal(5,2),
        b ~ normal(-1,0.5),
        sigma_cafe ~ exponential(1),
        sigma ~ exponential(1),
        Rho ~ lkj_corr(5)
    ) , data=d , chains=4 , cores=4, log_lik = TRUE )

## R code 14.13
post <- extract.samples(m14.1_c5)
dens( post$Rho[,1,2] )
```

![](data:image/png;base64,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)

``` {.r}
precis(m14.1_c5)
```

    ## 46 vector or matrix parameters hidden. Use depth=2 to show them.

    ##            mean         sd       5.5%      94.5%    n_eff      Rhat
    ## a      3.648945 0.21893177  3.3165434  3.9908264 2398.846 0.9982984
    ## b     -1.133753 0.14544576 -1.3706509 -0.9004367 2282.692 0.9986514
    ## sigma  0.473849 0.02658737  0.4339964  0.5177448 1967.775 1.0010761

``` {.r}
compare(m14.1, m14.1_c1, m14.1_c5)
```

    ##              WAIC       SE     dWAIC       dSE    pWAIC    weight
    ## m14.1    304.4816 17.66702 0.0000000        NA 32.65088 0.4385114
    ## m14.1_c1 305.1842 17.65367 0.7026295 0.6356839 32.71520 0.3086078
    ## m14.1_c5 305.5825 17.80683 1.1009348 0.7992392 33.02008 0.2528808

``` {.r}
## R code 14.14
# compute unpooled estimates directly from data
a1 <- sapply( 1:N_cafes ,
        function(i) mean(wait[cafe_id==i & afternoon==0]) )
b1 <- sapply( 1:N_cafes ,
        function(i) mean(wait[cafe_id==i & afternoon==1]) ) - a1

# extract posterior means of partially pooled estimates
post <- extract.samples(m14.1)
a2 <- apply( post$a_cafe , 2 , mean )
b2 <- apply( post$b_cafe , 2 , mean )

# plot both and connect with lines
plot( a1 , b1 , xlab="intercept" , ylab="slope" ,
    pch=16 , col=rangi2 , ylim=c( min(b1)-0.1 , max(b1)+0.1 ) ,
    xlim=c( min(a1)-0.1 , max(a1)+0.1 ) )
points( a2 , b2 , pch=1 )
for ( i in 1:N_cafes ) lines( c(a1[i],a2[i]) , c(b1[i],b2[i]) )

## R code 14.15
# compute posterior mean bivariate Gaussian
Mu_est <- c( mean(post$a) , mean(post$b) )
rho_est <- mean( post$Rho[,1,2] )
sa_est <- mean( post$sigma_cafe[,1] )
sb_est <- mean( post$sigma_cafe[,2] )
cov_ab <- sa_est*sb_est*rho_est
Sigma_est <- matrix( c(sa_est^2,cov_ab,cov_ab,sb_est^2) , ncol=2 )

# draw contours
library(ellipse)
for ( l in c(0.1,0.3,0.5,0.8,0.99) )
    lines(ellipse(Sigma_est,centre=Mu_est,level=l),
        col=col.alpha("black",0.2))
```

![](data:image/png;base64,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)

``` {.r}
## R code 14.16
# convert varying effects to waiting times
wait_morning_1 <- (a1)
wait_afternoon_1 <- (a1 + b1)
wait_morning_2 <- (a2)
wait_afternoon_2 <- (a2 + b2)

# plot both and connect with lines
plot( wait_morning_1 , wait_afternoon_1 , xlab="morning wait" ,
    ylab="afternoon wait" , pch=16 , col=rangi2 ,
    ylim=c( min(wait_afternoon_1)-0.1 , max(wait_afternoon_1)+0.1 ) ,
    xlim=c( min(wait_morning_1)-0.1 , max(wait_morning_1)+0.1 ) )
points( wait_morning_2 , wait_afternoon_2 , pch=1 )
for ( i in 1:N_cafes )
    lines( c(wait_morning_1[i],wait_morning_2[i]) ,
    c(wait_afternoon_1[i],wait_afternoon_2[i]) )
abline( a=0 , b=1 , lty=2 )

## R code 14.17
# now shrinkage distribution by simulation
v <- mvrnorm( 1e4 , Mu_est , Sigma_est )
v[,2] <- v[,1] + v[,2] # calculate afternoon wait
Sigma_est2 <- cov(v)
Mu_est2 <- Mu_est
Mu_est2[2] <- Mu_est[1]+Mu_est[2]

# draw contours
library(ellipse)
for ( l in c(0.1,0.3,0.5,0.8,0.99) )
    lines(ellipse(Sigma_est2,centre=Mu_est2,level=l),
        col=col.alpha("black",0.5))
```

![](data:image/png;base64,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)
:::
:::

::: {#practice .section .level2}
14.7. Practice
--------------

::: {#easy. .section .level3}
### Easy.

::: {#e1.-add-to-the-following-model-varying-slopes-on-the-predictor-x. .section .level4}
#### 14E1. Add to the following model varying slopes on the predictor x.

[\\\[ y \_i  Normal(\_i, ) \\\\ i =  \_{group\[i\]} + x\_i \\\\
\_{group}  Normal(,  \_ ) \\\\   Normal(0, 10) \\\\   Normal(0,
1) \\\\   HalfCauchy(0, 2) \\\\  \_  HalfCauchy(0, 2) \\\\
\\\]]{.math .display}
:::

::: {#model-with-varying-slopes .section .level4}
#### model with varying slopes

[\\\[ y \_i  Normal(\_i, ) \\\\ i =  \_{group\[i\]} + 
\_{group\[i\]}\*x\_i \\\\ \\begin{bmatrix} \_{group}\\\\  \_{group}
\\end{bmatrix} \\sim MVNormal( \\begin{bmatrix}\\\\  \\end{bmatrix} ,
S ) \\\\ S = \\begin{pmatrix} \_ & 0\\\\ 0 &  \_ \\end{pmatrix} \* R
\* \\begin{pmatrix} \_ & 0\\\\ 0 &  \_ \\end{pmatrix} \\\\  
Normal(0, 10) \\\\   Normal(0, 1) \\\\   HalfCauchy(0, 2) \\\\  \_
 HalfCauchy(0, 2) \\\\  \_  HalfCauchy(0, 2) \\\\ R \\sim LKJcorr(2)
\\\\ \\\]]{.math .display}
:::

::: {#e2.-think-up-a-context-in-which-varying-intercepts-will-be-positively-correlated-with-varying-slopes.-provide-a-mechanistic-explanation-for-the-correlation. .section .level4}
#### 14E2. Think up a context in which varying intercepts will be positively correlated with varying slopes. Provide a mechanistic explanation for the correlation.

> Lignin\_amount\_in\_cortex \~ a\[cultivar\] +
> b\[cultivar\]\*developmental\_stage

> Different tomato cultivars accumulate different amount of lignin in
> their cortex region in response to Cuscuta. Resistant cultivars
> accumulate more lignin than susceptible cultivars. And, their
> developmental stages also influence the amount of lignin accumulation.
> Usually older plants accumulate more lignin in stem.
:::

::: {#e3.-when-is-it-possible-for-a-varying-slopes-model-to-have-fewer-effective-parameters-as-estimated-by-waic-or-dic-than-the-corresponding-model-with-fixed-unpooled-slopes-explain. .section .level4}
#### 14E3. When is it possible for a varying slopes model to have fewer effective parameters (as estimated by WAIC or DIC) than the corresponding model with fixed (unpooled) slopes? Explain.

> It might happen when intercepts & slopes are highly correlated across
> groups. Because we treats correlation between intercepts & slopes
> independently for each group in the unpooled model; on the other hand,
> the pooled model relies on common distribution that can reduce the
> number of parameters.
:::
:::

::: {#medium. .section .level3}
### Medium.

::: {#m1.-repeat-the-caf-robot-simulation-from-the-beginning-of-the-chapter.-this-time-set-rho-to-zero-so-that-there-is-no-correlation-between-intercepts-and-slopes.-how-does-the-posterior-distribution-of-the-correlation-reflect-this-change-in-the-underlying-simulation .section .level4}
#### 14M1. Repeat the caf robot simulation from the beginning of the chapter. This time, set rho to zero, so that there is no correlation between intercepts and slopes. How does the posterior distribution of the correlation reflect this change in the underlying simulation?

``` {.r}
library(rethinking)

## R code 14.1
a <- 3.5            # average morning wait time
b <- (-1)           # average difference afternoon wait time
sigma_a <- 1        # std dev in intercepts
sigma_b <- 0.5      # std dev in slopes
rho <- 0       # correlation between intercepts and slopes

## R code 14.2
Mu <- c( a , b )

## R code 14.3
cov_ab <- sigma_a*sigma_b*rho
Sigma <- matrix( c(sigma_a^2,cov_ab,cov_ab,sigma_b^2) , ncol=2 )

## R code 14.4
matrix( c(1,2,3,4) , nrow=2 , ncol=2 )
```

    ##      [,1] [,2]
    ## [1,]    1    3
    ## [2,]    2    4

``` {.r}
## R code 14.5
sigmas <- c(sigma_a,sigma_b) # standard deviations
Rho <- matrix( c(1,rho,rho,1) , nrow=2 ) # correlation matrix

# now matrix multiply to get covariance matrix
Sigma <- diag(sigmas) %*% Rho %*% diag(sigmas)

## R code 14.6
N_cafes <- 20

## R code 14.7
library(MASS)
set.seed(5) # used to replicate example
vary_effects <- mvrnorm( N_cafes , Mu , Sigma )

## R code 14.8
a_cafe <- vary_effects[,1]
b_cafe <- vary_effects[,2]

## R code 14.9
plot( a_cafe , b_cafe , col=rangi2,
    xlab="intercepts (a_cafe)" , ylab="slopes (b_cafe)" )

# overlay population distribution
library(ellipse)
for ( l in c(0.1,0.3,0.5,0.8,0.99) )
    lines(ellipse(Sigma,centre=Mu,level=l),col=col.alpha("black",0.2))
```

![](data:image/png;base64,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)

> Simulate observations.

``` {.r}
## R code 14.10
set.seed(22)
N_visits <- 10
afternoon <- rep(0:1,N_visits*N_cafes/2)
cafe_id <- rep( 1:N_cafes , each=N_visits )
mu <- a_cafe[cafe_id] + b_cafe[cafe_id]*afternoon
sigma <- 0.5  # std dev within cafes
wait <- rnorm( N_visits*N_cafes , mu , sigma )
d <- data.frame( cafe=cafe_id , afternoon=afternoon , wait=wait )
```

``` {.r}
## R code 14.11
R <- rlkjcorr( 1e4 , K=2 , eta=2 )
dens( R[,1,2] , xlab="correlation" )
```

![](data:image/png;base64,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)

``` {.r}
### Rho ~ lkj_corr(2)
## R code 14.12
m14M1 <- ulam(
    alist(
        wait ~ normal( mu , sigma ),
        mu <- a_cafe[cafe] + b_cafe[cafe]*afternoon,
        c(a_cafe,b_cafe)[cafe] ~ multi_normal( c(a,b) , Rho , sigma_cafe ),
        a ~ normal(5,2),
        b ~ normal(-1,0.5),
        sigma_cafe ~ exponential(1),
        sigma ~ exponential(1),
        Rho ~ lkj_corr(2)
    ) , data=d , chains=4 , cores=4, log_lik = TRUE )
```

    ## recompiling to avoid crashing R session

``` {.r}
## R code 14.13
post <- extract.samples(m14.1)
dens( post$Rho[,1,2] )
```

![](data:image/png;base64,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)

``` {.r}
precis(m14.1)
```

    ## 46 vector or matrix parameters hidden. Use depth=2 to show them.

    ##             mean         sd      5.5%      94.5%    n_eff      Rhat
    ## a      3.6468261 0.21821411  3.297086  3.9969304 2564.340 0.9987379
    ## b     -1.1319608 0.14579208 -1.367303 -0.8979367 2314.553 0.9992617
    ## sigma  0.4739048 0.02684926  0.433027  0.5189561 1702.855 1.0022265

``` {.r}
precis(m14M1)
```

    ## 46 vector or matrix parameters hidden. Use depth=2 to show them.

    ##             mean         sd       5.5%      94.5%    n_eff      Rhat
    ## a      3.7073856 0.22512288  3.3305259  4.0732699 2246.713 0.9996966
    ## b     -1.1050016 0.15444627 -1.3423515 -0.8650223 2228.737 0.9983529
    ## sigma  0.4726195 0.02624027  0.4327794  0.5157430 1911.457 0.9987458

> there is no correlation between intercepts and slopes.
:::

::: {#m2.-fit-this-multilevel-model-to-the-simulated-caf-data .section .level4}
#### 14M2. Fit this multilevel model to the simulated caf data:

W i  Normal(i, ) i =  caf\[i\] +  caf\[i\] A i caf  Normal(,
  ) caf  Normal(,   )   Normal(0, 10)   Normal(0, 10)  
HalfCauchy(0, 1)    HalfCauchy(0, 1)    HalfCauchy(0, 1)
:::

::: {#use-waic-to-compare-this-model-to-the-model-from-the-chapter-the-one-that-uses-a-multi-variate-gaussian-prior.-explain-the-result. .section .level4}
#### Use WAIC to compare this model to the model from the chapter, the one that uses a multi-variate Gaussian prior. Explain the result.

``` {.r}
## R code 14.12
m14M2.1 <- ulam(
    alist(
        wait ~ normal( mu , sigma ),
        mu <- a_cafe[cafe] + b_cafe[cafe]*afternoon,
        a_cafe[cafe] ~ normal(a, a_sigma),
        b_cafe[cafe] ~ normal(b, b_sigma),
        a ~ normal(5,2),
        b ~ normal(-1,0.5),
        sigma ~ exponential(1),
        a_sigma ~ exponential(1),
        b_sigma ~ exponential(1)
    ) , data=d , chains=4 , cores=4, log_lik = TRUE)

precis(m14M2.1)
```

    ## 40 vector or matrix parameters hidden. Use depth=2 to show them.

    ##               mean         sd       5.5%      94.5%    n_eff      Rhat
    ## a        3.7198147 0.22698133  3.3581999  4.0827189 2513.451 0.9986344
    ## b       -1.1037335 0.14361469 -1.3318676 -0.8721835 2458.293 0.9999257
    ## sigma    0.4730062 0.02657617  0.4332071  0.5179588 1886.547 0.9989486
    ## a_sigma  0.9648344 0.17413889  0.7247180  1.2704698 2236.877 0.9991617
    ## b_sigma  0.6203021 0.13202147  0.4410577  0.8535043 1863.086 1.0005627

``` {.r}
## R code 14.12
m14M2.2 <- ulam(
    alist(
        wait ~ normal( mu , sigma ),
        mu <- a_cafe[cafe] + b_cafe[cafe]*afternoon,
        a_cafe[cafe] ~ normal(a, a_sigma),
        b_cafe[cafe] ~ normal(b, b_sigma),
        a ~ normal(0,10),
        b ~ normal(0,10),
        sigma ~ dcauchy(0,1),
        a_sigma ~ dcauchy(0,1),
        b_sigma ~ dcauchy(0,1)
    ) , data=d , chains=4 , cores=4, log_lik = TRUE)

precis(m14M2.2)
```

    ## 40 vector or matrix parameters hidden. Use depth=2 to show them.

    ##               mean         sd       5.5%      94.5%    n_eff      Rhat
    ## a        3.6939161 0.22966499  3.3282750  4.0630345 2346.922 0.9994352
    ## b       -1.1039129 0.15688277 -1.3549144 -0.8640025 2274.832 0.9989832
    ## sigma    0.4738339 0.02755822  0.4320311  0.5198623 1682.950 1.0017309
    ## a_sigma  0.9659869 0.16899186  0.7300187  1.2693349 2332.391 0.9988711
    ## b_sigma  0.6272784 0.13309830  0.4408241  0.8604863 2066.724 0.9990433

``` {.r}
compare(m14.1, m14M2.1, m14M2.2)
```

    ##             WAIC       SE    dWAIC      dSE    pWAIC    weight
    ## m14.1   304.4816 17.66702 0.000000       NA 32.65088 0.5872245
    ## m14M2.1 306.4812 17.88011 1.999628 1.772266 33.67501 0.2160680
    ## m14M2.2 306.6690 17.81148 2.187378 1.759974 33.79364 0.1967076
:::

::: {#m3.-re-estimate-the-varying-slopes-model-for-the-ucbadmit-data-now-using-a-non-centered-parameterization.-compare-the-efficiency-of-the-forms-of-the-model-using-n_eff.-which-is-better-which-chain-sampled-faster .section .level4}
#### 14M3. Re-estimate the varying slopes model for the UCBadmit data, now using a non-centered parameterization. Compare the efficiency of the forms of the model, using n\_eff. Which is better? Which chain sampled faster?
:::
:::
:::
:::
:::
